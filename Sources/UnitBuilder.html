<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>ユニットビルダー</title>
    <link rel="stylesheet" href="https://puarts.com/css/main.css?20181201" type="text/css" />
    <link rel="stylesheet" href="css/loading.css">
    <script>
        const g_startTime = Date.now();
    </script>
    <script>
        // 画像の遅延ロード用の処理。以下の要素を作ると遅延ロードされる
        // <img src="dummy.png" data-src="actual.png" class="lazy" />
        function loadLazyImages() {
            let lazyImages = [].slice.call(document.querySelectorAll("img.lazy"));
            let lazyInputs = [].slice.call(document.querySelectorAll("input.lazy"));
            if ("IntersectionObserver" in window) {
                let lazyImageObserver = new IntersectionObserver(function (entries, observer) {
                    entries.forEach(function (entry) {
                        if (entry.isIntersecting) {
                            let lazyImage = entry.target;
                            if (lazyImage.tagName == "IMG") {
                                lazyImage.src = lazyImage.dataset.src;
                                if (typeof lazyImage.dataset.srcset === "undefined") {
                                } else {
                                    lazyImage.srcset = lazyImage.dataset.srcset;
                                }
                            }
                            else if (lazyImage.tagName == "INPUT") {
                                lazyImage.style.backgroundImage = `url("${lazyImage.dataset.src}")`;
                            }
                            lazyImage.classList.remove("lazy");
                            lazyImageObserver.unobserve(lazyImage);
                        }
                    });
                });

                lazyImages.forEach(function (lazyImage) {
                    lazyImageObserver.observe(lazyImage);
                });
                lazyInputs.forEach(function (lazyInput) {
                    lazyImageObserver.observe(lazyInput);
                });
            } else {
                // Possibly fall back to a more compatible method here
            }
        }
    </script>
</head>

<body>
    <p>
        ユニットのステータスやスキル構成をシミュレートするツールです。闘技場スコアも表示しているので、闘技場スコア(査定)の計算にもご活用下さい。
    </p>
    <style>
        .container {
            /* margin: 20px auto; */
            max-width: 270px;
            float: left;
        }

        ul {
            margin: 0;
            padding: 0px;
        }

        li {
            list-style: none;
        }

        .tabs {
            overflow: hidden;
        }

        .tabs li,
        .tabs label {
            float: left;
            font-size: 11px;
            padding: 5px 5px;
            /* border: 1px solid #ccc; */
            cursor: pointer;
            /* transition: .3s; */
        }

        .tabs li:not(:first-child),
        .tabs label:not(:first-of-type) {
            border-left: none;
        }

        .tabs li.active,
        .tabs :checked+label {
            background-color: #000;
            border-color: #000;
            color: #fff;
            cursor: auto;
        }

        .contents {
            overflow: hidden;
            margin-top: -1px;
        }

        .contents li {
            border: 0px solid #ccc;
        }

        .unitDetailContainer {
            background-color: #daf0e2;
            padding: 5px;
            border: 2px solid #accfb9;
            border-radius: 20px;
        }

        .jquery .contents li {
            display: none;
        }

        .jquery .contents li.active {
            display: block;
        }

        div.block {
            float: left;
            display: block;
        }


        .tabs input {
            display: none;
        }

        .buttonUi {
            font-size: 11px;
            width: 120px;
        }

        .plusButtonUi {
            font-size: 12px;
            font-weight: bold;
            width: 25px;
            height: 25px;
            color: #fff;
            background-color: green;
            border-radius: 50%;
            border-width: 0px;
            border-collapse: collapse;
        }

        .minusButtonUi {
            font-size: 12px;
            font-weight: bold;
            min-width: 25px;
            height: 25px;
            color: #fff;
            background-color: orangered;
            border-radius: 50%;
            border-width: 0px;
            border-collapse: collapse;
        }

        .fehButton {
            display: inline-block;
            width: 62px;
            height: 62px;
            margin-left: -2px;
            margin-right: -2px;
            background-color: #ffffff;
            border-style: none;
            cursor: pointer;
            background-size: cover;
        }

        .fehButtonDisabled {
            display: inline-block;
            width: 62px;
            height: 62px;
            margin-left: -2px;
            margin-right: -2px;
            background-color: #ffffff;
            border-style: none;
            background-size: cover;
        }

        .imageButton:hover {
            filter: brightness(120%);
        }

        .menuButton {
            width: 23px;
            height: 23px;
            margin-left: 0px;
            margin-right: 0px;
            background-color: #dddddd;
            border-style: solid;
            border-color: grey;
            border-width: 1px;
            cursor: pointer;
            background-size: cover;
        }

        .playerButton {
            width: 25px;
            height: 25px;
            margin-left: 0px;
            margin-right: 0px;
            background-color: #dddddd;
            border-style: solid;
            border-color: grey;
            border-width: 1px;
            cursor: pointer;
            background-size: cover;
        }

        img.urlJumpIcon {
            width: 15px;
            height: 15px;
        }

        .statusInput {
            width: 50px;
        }

        .skillTypeText {
            position: absolute;
            bottom: 0;
            right: 0;
        }

        .paramHeader {
            font-size: 14px;
            padding: 2px 0px 3px 0px;
            text-align: left;
            font-weight: bold;
            /* background-color: #7fa1a0; */
            /* background-color: #27687c; */
            color: white;
            text-shadow: #444 1px 1px 0px, #444 -1px 1px 0px, #444 1px -1px 0px, #444 -1px -1px 0px, #444 0px 1px 0px, #444 0px -1px 0px, #444 -1px 0px 0px, #444 1px 0px 0px;
        }

        .skillHeader {
            font-size: 16px;
            padding: 0px;
            text-align: center;
            position: relative;
            color: white;
            text-shadow: #444 1px 1px 0px, #444 -1px 1px 0px, #444 1px -1px 0px, #444 -1px -1px 0px, #444 0px 1px 0px, #444 0px -1px 0px, #444 -1px 0px 0px, #444 1px 0px 0px;
        }

        .smallParam {
            width: 25px;
            text-align: left;
            font-size: 10px;
            color: rgb(192, 199, 190);
            text-shadow: #444 1px 1px 0px, #444 -1px 1px 0px, #444 1px -1px 0px, #444 -1px -1px 0px, #444 0px 1px 0px, #444 0px -1px 0px, #444 -1px 0px 0px, #444 1px 0px 0px;
        }

        td.param {
            min-width: 40px;
            padding: 0px 0px 2px 0px;
            text-align: right;
            font-size: 24px;
            color: lightyellow;
            text-shadow: #444 1px 1px 0px, #444 -1px 1px 0px, #444 1px -1px 0px, #444 -1px -1px 0px, #444 0px 1px 0px, #444 0px -1px 0px, #444 -1px 0px 0px, #444 1px 0px 0px;
        }

        .unitStatusAndSkillContainer {
            background-color: #6aa5a2;
            /* background-color: #27687c; */
            padding: 10px;
            border: 2px solid #59726c;
            /* border: 2px solid #accfb9; */
            border-radius: 20px;
            margin: 2px;
        }

        .assetStatus {
            color: rgb(161, 234, 252);
            text-shadow: #444 1px 1px 0px, #444 -1px 1px 0px, #444 1px -1px 0px, #444 -1px -1px 0px, #444 0px 1px 0px, #444 0px -1px 0px, #444 -1px 0px 0px, #444 1px 0px 0px;
        }

        .flowStatus {
            color: rgb(252, 161, 161);
            text-shadow: #444 1px 1px 0px, #444 -1px 1px 0px, #444 1px -1px 0px, #444 -1px -1px 0px, #444 0px 1px 0px, #444 0px -1px 0px, #444 -1px 0px 0px, #444 1px 0px 0px;
        }

        input.numeric {
            width: 40px;
        }

        input.numericFloat {
            width: 50px;
        }

        .normal {
            font-size: 11px;
        }

        .title {
            font-size: 16px;
            font-weight: bold;
        }

        tr.attackInfo {
            border: solid;
            border-width: 10px;
            padding: 0px;
            margin: 0px;
        }

        td.ally {
            background-color: cadetblue;
            color: gold;
            font-size: 8px;
            border: solid;
            border-color: lightblue;
            border-width: 1px;
        }

        td.enemy {
            background-color: rgb(177, 55, 55);
            color: gold;
            font-size: 8px;
            border: solid;
            border-color: lightpink;
            border-width: 1px;
        }

        select.hero {
            width: 160px;
        }

        select.blessing {
            width: 140px;
        }

        select.skill {
            width: 160px;
        }

        .debugInfo {
            font-size: 11px;
            /* visibility: hidden; */
        }

        .itemDialog-button {
            width: 200px;
        }

        .dialog-button {
            width: 100px;
        }

        .dialog-button-text {
            font-size: 14px;
        }

        input[type="checkbox"].fehButton {
            display: none;
        }

        input[class="fehButton"]:checked+label {
            filter: grayscale(0%);
        }

        input[class="fehButton"]:not(:checked)+label {
            filter: grayscale(100%);
        }

        .detailsDefault {
            text-align: left;
        }

        .iconButton {
            width: auto;
            padding: 0;
            margin: 0;
            background: none;
            border: 0;
            font-size: 0;
            line-height: 0;
            overflow: visible;
            cursor: pointer;
        }

        .editField {
            margin: 2px;
            display: inline-flex;
            background-color: #ddd;
            border: solid 1px #999;
            border-radius: 20px;
        }
    </style>

    <!-- 重要なところは予め接続 -->
    <link rel="preconnect" href="//cdnjs.cloudflare.com">
    <link rel="preconnect" href="//code.jquery.com">

    <!-- ローディングアイコン -->
    <div class="sk-fading-circle" id="loader">
        <div class="feh_loading_anim"></div>
        <div class="sk-circle1 sk-circle"></div>
        <div class="sk-circle2 sk-circle"></div>
        <div class="sk-circle3 sk-circle"></div>
        <div class="sk-circle4 sk-circle"></div>
        <div class="sk-circle5 sk-circle"></div>
        <div class="sk-circle6 sk-circle"></div>
        <div class="sk-circle7 sk-circle"></div>
        <div class="sk-circle8 sk-circle"></div>
        <div class="sk-circle9 sk-circle"></div>
        <div class="sk-circle10 sk-circle"></div>
        <div class="sk-circle11 sk-circle"></div>
        <div class="sk-circle12 sk-circle"></div>
    </div>

    <div id="app" style="display: none;">

        <table style="border-style: none;">
            <tr>
                <td>
                    <input type="button" style="background-image: url(https://puarts.com/images/dummy.png) "
                        class="lazy fehButton imageButton"
                        data-src="https://puarts.com/AetherRaidTacticsBoard/images/SaveState.png"
                        @click="g_app.clearSimpleLog();saveSettings();">
                    <input type="button" style="background-image: url(https://puarts.com/images/dummy.png) "
                        class="lazy fehButton imageButton"
                        data-src="https://puarts.com/AetherRaidTacticsBoard/images/LoadState.png"
                        @click="g_app.clearSimpleLog();loadSettings();g_app.setCurrentUnit(g_appData.allyUnits[0].id);">
                </td>
            </tr>
            <tr>
                <td>
                    <table>
                        <tr>
                            <td>
                                シーズン:<br />
                                <div class="block">
                                    <input id="isLightSeason" type="checkbox"
                                        v-model="globalBattleContext.isLightSeason" @change="lightSeasonChanged"><label
                                        class="normal" for="isLightSeason"><img
                                            src="https://puarts.com/AetherRaidTacticsBoard/images/Season_Light.png" />
                                        <img
                                            src="https://puarts.com/AetherRaidTacticsBoard/images/Season_Dark.png" /></label>
                                </div>
                                <div class="block">
                                    <input id="isAstraSeason" type="checkbox"
                                        v-model="globalBattleContext.isAstraSeason" @change="astraSeasonChanged"><label
                                        class="normal" for="isAstraSeason"><img
                                            src="https://puarts.com/AetherRaidTacticsBoard/images/Season_Astra.png" />
                                        <img
                                            src="https://puarts.com/AetherRaidTacticsBoard/images/Season_Anima.png" /></label>
                                </div>
                                <div class="block">
                                    <input id="isFireSeason" type="checkbox" v-model="globalBattleContext.isFireSeason"
                                        @change="seasonChanged"><label class="normal" for="isFireSeason"><img
                                            src="https://puarts.com/AetherRaidTacticsBoard/images/Season_Fire.png" /></label>
                                </div>
                                <div class="block">
                                    <input id="isWaterSeason" type="checkbox"
                                        v-model="globalBattleContext.isWaterSeason" @change="seasonChanged"><label
                                        class="normal" for="isWaterSeason"><img
                                            src="https://puarts.com/AetherRaidTacticsBoard/images/Season_Water.png" /></label>
                                </div>
                                <div class="block">
                                    <input id="isWindSeason" type="checkbox" v-model="globalBattleContext.isWindSeason"
                                        @change="seasonChanged">
                                    <label class="normal" for="isWindSeason">
                                        <img src="https://puarts.com/AetherRaidTacticsBoard/images/Season_Wind.png" />
                                    </label>
                                </div>
                                <div class="block">
                                    <input id="isEarthSeason" type="checkbox"
                                        v-model="globalBattleContext.isEarthSeason" @change="seasonChanged"><label
                                        class="normal" for="isEarthSeason"><img
                                            src="https://puarts.com/AetherRaidTacticsBoard/images/Season_Earth.png" /></label>
                                </div>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="block">
                        <div style="padding: 5px;">
                            <input type="button" class="buttonUi" @click="loadTeamMaxScore" value="全員の査定最大化">
                            <input id="isPairUpBoostsEnabled" v-model="isPairUpBoostsEnabled" type="checkbox"
                                @change="g_appData.__updateStatusBySkillsAndMergeForAllHeroes()"><label
                                for="isPairUpBoostsEnabled">ダブル補正有効</label>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div class="block">
                        <table
                            style="padding: 5px; border-style: solid; border-width: 2px; border-color:#6aa5a2; border-radius: 5px;">
                            <tr>
                                <td style="padding: 5px;background-color: #aadaa6;">
                                    <span style="padding-right: 10px;font-weight: bold;">編成</span>
                                    <span v-if="g_appData.gameMode == GameMode.Arena"
                                        style="font-size:12px"><br />スコア:{{arenaScore}}</span>
                                </td>
                                <td style="padding: 5px;background-color: #ccf8c8; ">
                                    <button v-for="unit in allyUnits" type="button"
                                        @click="g_app.setCurrentUnit(unit.id)" class="iconButton"
                                        v-bind:style="g_appData.currentUnit == unit ? 'position:relative;background-color: #ffffffff;border: 1px solid #ddddddff' : 'position:relative'">
                                        <img v-bind:src="unit.icon" style="max-width: 50px;" />
                                        <span class="paramHeader"
                                            style="padding:3px; position:absolute;right:0px;bottom:0px;">
                                            {{unit.arenaScore}}
                                        </span>
                                    </button>
                                </td>
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>

            <tr>
                <td valign="top">
                    <div class="jquery" id="unitSettings">
                        <ul class="contents">
                            <li v-for="unit in allyUnits">
                                <div style="margin: 5px;">
                                    <input type="button" class="buttonUi" style="width:80px"
                                        @click="g_appData.copyCurrentUnit()" value="コピー">
                                    <input type="button" class="buttonUi" style="width:80px"
                                        @click="g_appData.pasteToCurrentUnit();" value="ペースト">
                                    <span v-show="unit.canHavePairUpUnit">
                                        <input type="button" value="ダブル前衛を編集" @click="unit.isEditingPairUpUnit = false"
                                            v-if="unit.isEditingPairUpUnit" class="buttonUi">
                                        <span v-if="!unit.isEditingPairUpUnit">
                                            <input type="button" value="ダブル後衛を編集"
                                                @click="unit.isEditingPairUpUnit = true" class="buttonUi">
                                        </span>
                                    </span>
                                </div>

                                <unit-detail v-model="unit" v-if="!unit.canHavePairUpUnit || !unit.isEditingPairUpUnit">
                                </unit-detail>
                                <unit-detail v-model="unit.pairUpUnit"
                                    v-show="unit.canHavePairUpUnit && unit.isEditingPairUpUnit"></unit-detail>
                            </li>
                        </ul>
                    </div>
                </td>
            </tr>
            <tr v-bind:style="debugMenuStyle">
                <td>
                    <div>
                        <input type="button" value="ユニットの選択解除" @click="g_appData.clearCurrentItemSelection()">
                    </div>
                    currentItemIndex={{currentItemIndex}}
                </td>
            </tr>
            <tr>
                <td>
                    <details open style="padding: 5;" class="detailsDefault">
                        <summary>設定の共有</summary>
                        以下のURLで設定を再現する事ができます。<br />
                        <input type="button" value="コピー" @click="copyUrl">
                        <!-- <input type="button" value="インポート" @click="importUrl(g_appData.currentUrl)"> -->
                        <br />
                        <textarea id="urlTextArea" v-model="exportSettingUrl" style="width: 400px;height: 50px;"
                            readonly></textarea>
                    </details>

                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <div style="float:right">
                        <input id="debugMenuEnabled" type="checkbox" v-model="isDebugMenuEnabled"
                            @change="debugMenuEnabledChanged"><label class="normal"
                            for="debugMenuEnabled">デバッグモード有効(開発者用)</label>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <span style="font-size:12px"><b>デバッグログ</b></span>
                    <input id="showDetailLog" type="checkbox" v-model="showDetailLog"
                        @change="showDetailLogChanged"><label class="normal" for="showDetailLog">詳細ログを出力</label>
                    <input type="button" @click="g_app.clearLog()" value="クリア" style="font-size: 8px;" />
                    <input type="button" @click="copyDebugLogToClipboard()" value="コピー" style="font-size: 8px;" />
                    <div v-html="damageCalcLog" id="debugLogPanel"
                        style="height: 400px; border: 1px solid #dddddd;background-color: #ffffff;overflow-y: scroll;">
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <style>
        .select2-results__options {
            font-size: 12px;
        }

        .select2-selection__rendered {
            font-size: 12px;
        }

        .card {
            float: left;
            display: block;
            /* background-color: #f33; */
            width: 312px;
            padding: 10px 0px 10px 10px;
        }

        hr {
            padding: 0px;
            border: none;
            border-top: medium double #333;
            color: #333;
            text-align: center;
        }
    </style>
    <script type="text/x-template" id="unit-detail-template">
        <div v-if="value != null">
            <div class="unitStatusAndSkillContainer" style="float:left;display:block;padding: 10px 0px 10px 10px;position:relative;" >
                <div style="float:right;position:absolute;top:4px;right:4px" v-if="value.hasPairUpUnit">
                    <div style="position:relative">
                    <img src="https://puarts.com/AetherRaidTacticsBoard/images/PairUp.png" width="30"
                        height="30" style="position:absolute; right:25px" />
                    <button type="button"
                        @click="value.isEditingPairUpUnit = true" class="iconButton"
                        style="position:relative">
                        <img v-bind:src="value.pairUpUnit.icon" width="30"
                            height="30" />
                    </button>
                    </div>
                </div>
                <div class='paramHeader' style="text-align:left;">
                    <table>
                        <tr>
                            <td rowspan="2">
                                <div style="padding: 0px 10px 0px 0px;position:relative">
                                    <img v-bind:src="value.icon" width="50" height="50" />
                                </div>
                            </td>
                            <td class="paramHeader">
                                ★
                                <select v-model="value.rarity" @change="g_app.vm.ivChanged(); updateUrl();">
                                    <option v-for="item in UnitRarity" v-bind:value="item">
                                        {{ item}}
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td class="paramHeader">
                                <label class="normal" for="merge">LV.</label>
                                <input name="level" type="number" v-model="value.level"
                                    min="1" max="99" class="numeric" @input="updateStatus(value);" />
                                +
                                <select v-model="value.merge" @change="updateStatus(value);">
                                    <option v-for="(value, i) in (10+1)" v-bind:value="i">
                                        {{ i }}
                                    </option>
                                </select>

                                <label class="normal" for="dragonflower">
                                    <img v-bind:src="value.dragonflowerIcon" width="25" height="25" />
                                +</label>
                                <select v-model="value.dragonflower" @change="g_app.vm.dragonflowerChanged(); updateUrl();">
                                    <option v-for="(value, i) in (value.maxDragonflower+1)" v-bind:value="i">
                                        {{ i }}
                                    </option>
                                </select>
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="float:left;">
                    <table border='0' style='border-width: 0px;border-style:none;'>
                        <tr>
                            <td class='paramHeader'>
                            </td>
                            <td class='paramHeader'>
                            </td>
                        </tr>
                        <tr>
                            <td class='paramHeader'>
                                <span v-if="value.isAsset(StatusType.Hp)" class="assetStatus">
                                HP
                                </span>
                                <span v-else-if="value.isFlaw(StatusType.Hp)" class="flowStatus">
                                HP
                                </span>                                        
                                <span v-else>
                                HP
                                </span>
                            </td>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.atkWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.maxHpWithSkillsWithoutAdd}}
                            </td>
                            <td class='smallParam'>
                                ({{value.heroInfo != null ? toSignedStr(value.maxHpWithSkillsWithoutAdd-value.heroInfo.hp) : 0}})
                            </td>
                        </tr>
                        <tr>
                            <td class='paramHeader'>
                                <span v-if="value.isAsset(StatusType.Atk)" class="assetStatus">
                                攻撃
                                </span>
                                <span v-else-if="value.isFlaw(StatusType.Atk)" class="flowStatus">
                                攻撃
                                </span>                                        
                                <span v-else>
                                攻撃
                                </span>
                            </td>
                            <td class='param'>
                                {{value.atkWithSkills-value.atkAdd}}
                            </td>
                            <td class='smallParam'>
                                ({{value.heroInfo != null ? toSignedStr(value.atkWithSkills-value.heroInfo.atk) : 0}})
                            </td>
                        </tr>
                        <tr>
                            <td class='paramHeader'>
                                <span v-if="value.isAsset(StatusType.Spd)" class="assetStatus">
                                速さ
                                </span>
                                <span v-else-if="value.isFlaw(StatusType.Spd)" class="flowStatus">
                                速さ
                                </span>                                        
                                <span v-else>
                                速さ
                                </span>
                                
                            </td>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.spdWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.spdWithSkills-value.spdAdd}}
                            </td>
                            <td class='smallParam'>
                                ({{value.heroInfo != null ? toSignedStr(value.spdWithSkills-value.heroInfo.spd) : 0}})
                            </td>
                        </tr>
                        <tr>
                            <td class='paramHeader'>
                                <span v-if="value.isAsset(StatusType.Def)" class="assetStatus">
                                守備
                                </span>
                                <span v-else-if="value.isFlaw(StatusType.Def)" class="flowStatus">
                                守備
                                </span>                                        
                                <span v-else>
                                守備
                                </span>
                                
                            </td>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.defWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.defWithSkills-value.defAdd}}
                            </td>
                            <td class='smallParam'>
                                ({{value.heroInfo != null ? toSignedStr(value.defWithSkills-value.heroInfo.def) : 0}})
                            </td>
                        </tr>
                        <tr>
                            <td class='paramHeader'>
                                <span v-if="value.isAsset(StatusType.Res)" class="assetStatus">
                                魔防
                                </span>
                                <span v-else-if="value.isFlaw(StatusType.Res)" class="flowStatus">
                                魔防
                                </span>                                        
                                <span v-else>
                                魔防
                                </span>
                                
                            </td>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.resWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.resWithSkills-value.resAdd}}
                            </td>
                            <td class='smallParam'>
                                ({{value.heroInfo != null ? toSignedStr(value.resWithSkills-value.heroInfo.res) : 0}})
                            </td>
                        </tr>
                        <tr>
                            <td class='paramHeader'>
                                合計
                            </td>
                            <td class='param'>
                                {{value.maxHpWithSkillsWithoutAdd + value.atkWithSkills+value.atkBuff+value.atkDebuff
                                    +value.spdWithSkills+value.spdBuff+value.spdDebuff
                                    +value.defWithSkills+value.defBuff+value.defDebuff
                                    +value.resWithSkills+value.resBuff+value.resDebuff}}
                            </td>
                            <td class='smallParam'>
                                ({{value.heroInfo != null ? toSignedStr(value.maxHpWithSkillsWithoutAdd+value.atkWithSkills+value.spdWithSkills+value.defWithSkills+value.resWithSkills
                                    -(value.heroInfo.getStatusTotalOfLv40())) : 0}})
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <hr />
                            </td>
                        </tr>

                        <tr>
                            <td class='paramHeader'>
                                絆
                            </td>
                            <td class='param'>
                                <select v-model="value.summonerLevel" @change="g_app.vm.summonerLevelChanged(); updateUrl();">
                                    <option v-for="option in g_appData.summonerLevelOptions" v-bind:value="option.id">
                                        {{ option.text }}
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td class='paramHeader'>
                                <span v-if="value.heroInfo!=null && value.heroInfo.isResplendent">
                                    <label v-bind:for='"isResplendent"+value.id'>神装</label>
                                </span>
                            </td>
                            <td class='param'>
                                <span v-if="value.heroInfo!=null && value.heroInfo.isResplendent">
                                    <input v-bind:id='"isResplendent"+value.id' type="checkbox" v-model="value.isResplendent" @change="g_app.vm.isBonusCharChanged(); updateUrl();" />
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td class='paramHeader'>
                                <label v-bind:for='"isBonusChar"+value.id'>ボナ</label>
                            </td>
                            <td class='param'>
                                <input v-bind:id='"isBonusChar"+value.id' type="checkbox" v-model="value.isBonusChar" @change="g_app.vm.isBonusCharChanged(); updateUrl();" />
                            </td>
                        </tr>
                        <tr>
                            <td class='paramHeader'>
                                <span v-if="isWeaponTypeBeast(value.weaponType)">
                                    <label class="paramHeader" v-bind:for='"isTransformed"+value.id'>化身</label>
                                </span>
                            </td>
                            <td class='param'>
                                <span v-if="isWeaponTypeBeast(value.weaponType)">
                                    <input v-bind:id='"isTransformed"+value.id' type="checkbox" v-model="value.isTransformed" @change="updateStatus(value);" />
                                </span>
                            </td>
                        </tr>
                    </table>
                </div>
                <div style="float:left;padding: 0px 0px 0px 0px;">
                    <table border="0" style="border-style:none;">
                        <tr>
                            <td class='skillHeader'>
                                <img src="https://puarts.com/AetherRaidTacticsBoard/images/Weapon.png" width="25" height="25" />
                            </td>
                            <td colspan="2">
                                <select2 :options="value.heroInfo.weaponOptions" v-model="value.weapon" v-bind:name="value.id+'-weapon'" v-if="value.heroInfo!=null"
                                    @input="g_app.vm.weaponChanged(); updateUrl();" class="skill" >
                                </select2>
                                <a v-bind:href="value.weaponInfo.detailPageUrl" target="_blank" v-if="value.weaponInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>
                                <span  class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >
                                    ({{value.weapon}})
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td class='skillHeader'>
                            </td>
                            <td colspan="2">
                                <select v-model="value.weaponRefinement" @change="g_app.vm.weaponOptionChanged(); updateUrl();" >
                                    <option v-for="option in (value.weaponInfo != null ? value.weaponInfo.weaponRefinementOptions : [])" v-bind:value="option.id">
                                        {{ option.text }}
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td class='skillHeader'>
                                <img src="https://puarts.com/AetherRaidTacticsBoard/images/Support.png" width="25" height="25" />
                            </td>
                            <td colspan="2">
                                <select2 :options="value.heroInfo.supportOptions" v-if="value.heroInfo!=null"
                                @input="g_app.vm.supportChanged(); updateUrl();"
                                v-bind:name="value.id+'-support'"
                                    v-model="value.support" class="skill">
                                </select2>
                                <a v-bind:href="value.supportInfo.detailPageUrl" target="_blank" v-if="value.supportInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>
                                <span  class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >
                                    ({{value.support}})
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td class='skillHeader'>
                                <img src="https://puarts.com/AetherRaidTacticsBoard/images/Special.png" width="25" height="25" />
                                <span v-if="value.specialInfo != null" class="skillTypeText">
                                    {{value.maxSpecialCount}}
                                </span>
                            </td>
                            <td colspan="2">
                                <select2 :options="value.heroInfo.specialOptions" v-model="value.special" v-bind:name="value.id+'-special'" v-if="value.heroInfo!=null"
                                    @input="g_app.vm.specialChanged(); updateUrl();" class="skill">
                                </select2>
                                <a v-bind:href="value.specialInfo.detailPageUrl" target="_blank" v-if="value.specialInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>
                                <span  class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >
                                    ({{value.special}})
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td class='skillHeader'>
                                <img v-if="value.passiveAInfo != null" v-bind:src="value.passiveAInfo.iconPath" width="25" height="25" />
                                <img v-else v-bind:src="g_imageRootPath + 'None.png'" width="25" height="25" />
                                <img v-bind:src="g_imageRootPath + 'A.png'" class="skillTypeText" width="12" height="12" />
                            </td>
                            <td colspan="2">
                                <select2 :options="value.heroInfo.passiveAOptions" v-bind:name="value.id+'-passiveA'" v-if="value.heroInfo!=null"
                                    v-model="value.passiveA" @input="g_app.vm.passiveAChanged(); updateUrl();" class="skill">
                                </select2>
                                <a v-bind:href="value.passiveAInfo.detailPageUrl" target="_blank" v-if="value.passiveAInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>
                                <span  class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >
                                    ({{value.passiveA}})
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td class='skillHeader'>
                                <img v-if="value.passiveBInfo != null" v-bind:src="value.passiveBInfo.iconPath" width="25" height="25" />
                                <img v-else v-bind:src="g_imageRootPath + 'None.png'" width="25" height="25" />
                                <img v-bind:src="g_imageRootPath + 'B.png'" class="skillTypeText" width="12" height="12" />
                            </td>
                            <td colspan="2">
                                <select2 :options="value.heroInfo.passiveBOptions" v-bind:name="value.id+'-passiveB'" v-if="value.heroInfo!=null"
                                    v-model="value.passiveB" class="skill" @input="g_app.vm.passiveBChanged(); updateUrl();">
                                </select2>
                                <a v-bind:href="value.passiveBInfo.detailPageUrl" target="_blank" v-if="value.passiveBInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>
                                <span  class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >
                                    ({{value.passiveB}})
                                </span>

                            </td>
                        </tr>
                        <tr>
                            <td class='skillHeader'>
                                <img v-if="value.passiveCInfo != null" v-bind:src="value.passiveCInfo.iconPath" width="25" height="25" />
                                <img v-else v-bind:src="g_imageRootPath + 'None.png'" width="25" height="25" />
                                <img v-bind:src="g_imageRootPath + 'C.png'" class="skillTypeText" width="12" height="12" />
                            </td>
                            <td colspan="2">
                                <select2 :options="value.heroInfo.passiveCOptions" v-bind:name="value.id+'-passiveC'" v-if="value.heroInfo!=null"
                                    v-model="value.passiveC" @input="g_app.vm.passiveCChanged(); updateUrl();" class="skill">
                                </select2>
                                <a v-bind:href="value.passiveCInfo.detailPageUrl" target="_blank" v-if="value.passiveCInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>
                                <span  class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >
                                    ({{value.passiveC}})
                                </span>

                            </td>
                        </tr>
                        <tr>
                            <td class='skillHeader'>
                                <img v-if="value.passiveSInfo != null" v-bind:src="value.passiveSInfo.iconPath" width="25" height="25" />
                                <img v-else v-bind:src="g_imageRootPath + 'None.png'" width="25" height="25" />
                                <img v-bind:src="g_imageRootPath + 'S.png'" class="skillTypeText" width="12" height="12" />
                            </td>
                            <td colspan="2">
                                <select2 :options="value.heroInfo.passiveSOptions" v-bind:name="value.id+'-passiveS'" v-if="value.heroInfo!=null"
                                         v-model="value.passiveS" @input="g_app.vm.passiveSChanged(); updateUrl();" class="skill">
                                </select2>
                                <a v-bind:href="value.passiveSInfo.detailPageUrl" target="_blank" v-if="value.passiveSInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>
                                <span  class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >
                                    ({{value.passiveS}})
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td class='skillHeader'>
                                <img v-if="value.passiveXInfo != null" v-bind:src="value.passiveXInfo.iconPath" width="25" height="25" />
                                <img v-else v-bind:src="g_imageRootPath + 'None.png'" width="25" height="25" />
                                <img v-bind:src="g_imageRootPath + 'X.webp'" class="skillTypeText" width="12" height="12" />
                            </td>
                            <td colspan="2">
                                <select2 :options="value.heroInfo.passiveXOptions" v-bind:name="value.id+'-passiveX'" v-if="value.heroInfo!=null"
                                    v-model="value.passiveX" @input="g_app.vm.passiveXChanged(); updateUrl();" class="skill">
                                </select2>
                                <a v-bind:href="value.passiveXInfo.detailPageUrl" target="_blank" v-if="value.passiveXInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>
                                <span  class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >
                                    ({{value.passiveX}})
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 10px 0px 0px 0px"></td>
                        </tr>
                        <tr  v-if="!value.isPairUpUnit">
                            <td></td>
                            <td class='paramHeader'>
                                合計SP
                            </td>
                            <td class='param'>
                                <span style="margin: 0px 15px 0px 0px">
                                {{value.totalSp}}
                                </span>
                            </td>
                        </tr>
                        <tr  v-if="!value.isPairUpUnit">
                            <td></td>
                            <td class='paramHeader'>
                                スコア
                            </td>
                            <td class='param'>
                                <span style="margin: 0px 15px 0px 0px">
                                {{value.arenaScore}} <span style='font-size: 16px;'>({{value.arenaScore*2}})</span>
                                </span>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="editField">
                <div class="card">
                    <dl style="margin: 0;">
                        <dt><label class="title">英雄:</label></dt>
                        <dd>
                            <select2 :options="g_app.vm.heroOptions" v-model="value.heroIndex" class="hero"
                                @input="g_app.vm.heroIndexChanged(); updateUrl();">
                            </select2>
                            <a v-bind:href="value.detailPageUrl" target="_blank" v-if="value.heroIndex >= 0">
                                <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>
                            <span class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >({{value.heroIndex}})</span>
                        </dd>

                        <dt><label class="title">個性:</label></dt>
                        <dd>
                            <label class="normal" for="ivHigh">得意 </label>
                            <select v-model="value.ivHighStat" @change="g_app.vm.ivChanged(); updateUrl();">
                                <option v-for="option in IvStateOptions" v-bind:value="option.id">
                                    {{ option.text }}
                                </option>
                            </select>
                            <label class="normal" for="ivLow">苦手 </label>
                            <select v-model="value.ivLowStat" @change="g_app.vm.ivChanged(); updateUrl();">
                                <option v-for="option in IvStateOptions" v-bind:value="option.id">
                                    {{ option.text }}
                                </option>
                            </select>
                            <label class="normal"><img
                                    src="/AetherRaidTacticsBoard/images/AscendedFloret.png" width="20"
                                    height="20"></label>
                            <select v-model="value.ascendedAsset" @change="g_app.vm.ivChanged(); updateUrl();">
                                <option v-for="option in IvStateOptions" v-bind:value="option.id">
                                    {{ option.text }}
                                </option>
                            </select>
                        </dd>
                        <dt v-if="value.providableBlessingSeason == SeasonType.None && !value.isPairUpUnit">
                            <label class="title">祝福:</label></dt>
                        <dd v-if="value.providableBlessingSeason == SeasonType.None && !value.isPairUpUnit">
                            <select v-model="value.grantedBlessing" @change="g_app.vm.grantedBlessingChanged">
                                <option v-for="option in g_appData.seasonOptions" v-bind:value="option.id">
                                    {{ option.text }}
                                </option>
                            </select>
                        </dd>
                        <dt v-if="!value.isPairUpUnit" ><label class="title">祝福効果: </label></dt>
                        <dd v-if="!value.isPairUpUnit">  
                            <select v-model="value.blessing1" @change="updateStatus(value);">
                                <option v-for="option in BlessingTypeOptions" v-bind:value="option.id">
                                    {{ option.text }}
                                </option>
                            </select>
                            <select v-model="value.blessing2" @change="updateStatus(value);">
                                <option v-for="option in BlessingTypeOptions" v-bind:value="option.id">
                                    {{ option.text }}
                                </option>
                            </select>
                            <select v-model="value.blessing3" @change="updateStatus(value);">
                                <option v-for="option in BlessingTypeOptions" v-bind:value="option.id">
                                    {{ option.text }}
                                </option>
                            </select>
                            <select v-model="value.blessing4" @change="updateStatus(value);">
                                <option v-for="option in BlessingTypeOptions" v-bind:value="option.id">
                                    {{ option.text }}
                                </option>
                            </select>
                            <select v-model="value.blessing5" @change="updateStatus(value);">
                                <option v-for="option in BlessingTypeOptions" v-bind:value="option.id">
                                    {{ option.text }}
                                </option>
                            </select>
                        </dd>
                    </dl>
                    <div style="margin: 10px 0">
                        <input type="button" class="buttonUi" value="凸と花を最大化" @click="value.maximizeMergeAndDragonflower();updateStatus(value);" />
                        <input type="button" class="buttonUi" value="リセット" @click="resetUnit(value)" />
                        <input type="button" class="buttonUi" @click="g_app.setUnitToMaxArenaScore(value)"  v-if="!value.isPairUpUnit" value="最大査定に設定"></input>
                        <input type="button" class="buttonUi" value="初期スキル装備" @click="value.clearReservedSkills();value.initializeSkillsToDefault();updateUrl();" >
                        <input type="button" class="buttonUi" value="スキル全て外す" @click="value.clearReservedSkills();value.clearSkills();updateUrl();" >
                    </div>
                    <fieldset style="font-size:12px;background-color:#eee;border-radius: 10px;margin-right:10px;"  v-if="!value.isPairUpUnit">
                        <legend>闘技場スコア詳細</legend>
                        
                        <span>スコア: {{value.arenaScore}}({{value.arenaScore*2}})</span><br/>
                        <span style="color:#555">
                        計算式: (150 + {{value.rarityScore}} + {{value.levelScore}} + ({{value.rating}} / 5) + ({{value.totalSp}} / 100) + ({{value.merge}} * 2)) * 2<br/>
                        基礎能力: {{value.rating}}<br/>
                        合計SP: {{value.totalSp}}({{value.weaponSp}}+{{value.supportSp}}+{{value.specialSp}}+{{value.passiveASp}}+{{value.passiveBSp}}+{{value.passiveCSp}}+{{value.passiveSSp}})</span><br/>
                    </fieldset>
                </div>
            </div>
        </div>
    </script>

    <!-- jquery -->
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

    <!-- select2 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css"
        media="print" onload="this.media='all'">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>

    <!-- jquery-ui -->
    <!-- <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.min.css" media="print"
        onload="this.media='all'">
    <script async src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script> -->

    <!-- vue.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.13/vue.min.js"></script>

    <!-- sortable.js -->
    <script async src="https://cdn.jsdelivr.net/npm/sortablejs@1.8.4/Sortable.min.js"></script>

    <!-- vuedraggable.js -->
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/2.23.2/vuedraggable.umd.min.js"></script>

    <!-- クッキー(実際は使ってないので消してもいいかも) -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script> -->

    <!-- 文字列圧縮 -->
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

    <!-- 画像解析 -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.min.css" media="print"
        onload="this.media='all'">
    <script async type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.min.js"></script> -->

    <!-- <script defer type="text/javascript" src="https://docs.opencv.org/4.2.0/opencv.js"></script> -->






    <script>
        function createScriptElement(src, onloadFunc) {
            let element = document.createElement("script");
            element.type = "text/javascript";
            element.src = src;
            element.onload = onloadFunc;
            // document.body.appendChild(element);
            let headElement = document.getElementsByTagName('head')[0];
            headElement.appendChild(element);
        }

        function loadScripts(scriptFileNames, allScriptLoaded, index = 0) {
            if (index == scriptFileNames.length) {
                allScriptLoaded();
                return;
            }

            let jsRootPath = "./";
            // jsRootPath = "/AetherRaidTacticsBoard/Release2/";
            let reloadSuffix = "20200513";
            let scriptFileName = scriptFileNames[index];
            let src = jsRootPath + scriptFileName + "?" + reloadSuffix;
            const startTime = Date.now();
            createScriptElement(src, x => {
                const endTime = Date.now();
                console.log(`${endTime - startTime} ms to load ${src}`);
                loadScripts(scriptFileNames, allScriptLoaded, ++index);
            });
        }

        window.addEventListener('load', (event) => {
            const isLocal = typeof weaponInfos == 'undefined';
            console.log(`isLocal=${isLocal}`);
            let additionalScripts = [];
            if (isLocal) {
                additionalScripts = [
                    "GlobalDefinitions_Debug.js",
                    "Cell.js",
                    "Table.js",
                    "Utilities.js",
                    "Logger.js",
                    "Skill.js",
                    "BattleMapElement.js",
                    "Tile.js",
                    "Structures.js",
                    "HeroInfo.js",
                    "Unit.js",
                    "UnitManager.js",
                    "BattleMap.js",
                    "BattleMapSettings.js",
                    "GlobalBattleContext.js",
                    "DamageCalculationUtility.js",
                    "DamageCalculator.js",
                    "PostCombatSkillHander.js",
                    "DamageCalculatorWrapper.js",
                    "BeginningOfTurnSkillHandler.js",
                    "TurnSetting.js",
                    "AudioManager.js",
                    "AetherRaidDefensePresets.js",
                    "SkillDatabase.js",
                    "HeroDatabase.js",
                    "SettingManager.js",
                    "AppData.js",
                    "Main_ImageProcessing.js",
                    "Main_OriginalAi.js",
                    "Main_MouseAndTouch.js",
                    "BattleSimulatorBase.js",
                    "UnitBuilderMain.js",
                    "VueComponents.js",
                    "SampleSkillInfos.js",
                    "SampleHeroInfos.js",
                ];
            }
            const startTime = Date.now();
            loadScripts(additionalScripts, () => {
                const endTime = Date.now();
                console.log(`${endTime - startTime} ms to load all scripts`);
                console.log("initializing application");
                g_app.registerSkillOptions(weaponInfos, supportInfos, specialInfos, passiveAInfos, passiveBInfos, passiveCInfos,
                    passiveSInfos, passiveXInfos, [], false);
                g_app.registerHeroOptions(heroInfos, false);

                initUnitBuilder();

                if (isLocal) {
                    loadLazyImages();
                }

                const loader = document.getElementById("loader");
                loader.style.display = "none";
                const app = document.getElementById("app");
                app.style.display = "";
            });
        });
    </script>
</body>