<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>ユニットビルダー</title>
    <link rel="stylesheet" href="https://puarts.com/css/main.css?20181201" type="text/css" />
    <script>
        const g_startTime = Date.now();
    </script>
    <script>
        // 画像の遅延ロード用の処理。以下の要素を作ると遅延ロードされる
        // <img src="dummy.png" data-src="actual.png" class="lazy" />
        function loadLazyImages() {
            let lazyImages = [].slice.call(document.querySelectorAll("img.lazy"));
            let lazyInputs = [].slice.call(document.querySelectorAll("input.lazy"));
            if ("IntersectionObserver" in window) {
                let lazyImageObserver = new IntersectionObserver(function (entries, observer) {
                    entries.forEach(function (entry) {
                        if (entry.isIntersecting) {
                            let lazyImage = entry.target;
                            if (lazyImage.tagName == "IMG") {
                                lazyImage.src = lazyImage.dataset.src;
                                if (typeof lazyImage.dataset.srcset === "undefined") {
                                } else {
                                    lazyImage.srcset = lazyImage.dataset.srcset;
                                }
                            }
                            else if (lazyImage.tagName == "INPUT") {
                                lazyImage.style.backgroundImage = `url("${lazyImage.dataset.src}")`;
                            }
                            lazyImage.classList.remove("lazy");
                            lazyImageObserver.unobserve(lazyImage);
                        }
                    });
                });

                lazyImages.forEach(function (lazyImage) {
                    lazyImageObserver.observe(lazyImage);
                });
                lazyInputs.forEach(function (lazyInput) {
                    lazyImageObserver.observe(lazyInput);
                });
            } else {
                // Possibly fall back to a more compatible method here
            }
        }
    </script>
</head>

<body>
    <style>
        .container {
            /* margin: 20px auto; */
            max-width: 270px;
            float: left;
        }

        ul {
            margin: 0;
            padding: 0;
        }

        li {
            list-style: none;
        }

        .tabs {
            overflow: hidden;
        }

        .tabs li,
        .tabs label {
            float: left;
            font-size: 11px;
            padding: 5px 5px;
            /* border: 1px solid #ccc; */
            cursor: pointer;
            /* transition: .3s; */
        }

        .tabs li:not(:first-child),
        .tabs label:not(:first-of-type) {
            border-left: none;
        }

        .tabs li.active,
        .tabs :checked+label {
            background-color: #000;
            border-color: #000;
            color: #fff;
            cursor: auto;
        }

        .contents {
            overflow: hidden;
            margin-top: -1px;
        }

        .contents li {
            border: 1px solid #ccc;
        }

        .jquery .contents li {
            display: none;
        }

        .jquery .contents li.active {
            display: block;
        }

        .tabs input {
            display: none;
        }

        .buttonUi {
            font-size: 11px;
        }

        .plusButtonUi {
            font-size: 12px;
            font-weight: bold;
            width: 25px;
            height: 25px;
            color: #fff;
            background-color: green;
            border-radius: 50%;
            border-width: 0px;
            border-collapse: collapse;
        }

        .minusButtonUi {
            font-size: 12px;
            font-weight: bold;
            width: 25px;
            height: 25px;
            color: #fff;
            background-color: orangered;
            border-radius: 50%;
            border-width: 0px;
            border-collapse: collapse;
        }

        .fehButton {
            display: inline-block;
            width: 62px;
            height: 62px;
            margin-left: -2px;
            margin-right: -2px;
            background-color: #ffffff;
            border-style: none;
            cursor: pointer;
            background-size: cover;
        }

        .fehButtonDisabled {
            display: inline-block;
            width: 62px;
            height: 62px;
            margin-left: -2px;
            margin-right: -2px;
            background-color: #ffffff;
            border-style: none;
            background-size: cover;
        }

        .imageButton:hover {
            filter: brightness(120%);
        }

        .menuButton {
            width: 23px;
            height: 23px;
            margin-left: 0px;
            margin-right: 0px;
            background-color: #dddddd;
            border-style: solid;
            border-color: grey;
            border-width: 1px;
            cursor: pointer;
            background-size: cover;
        }

        .playerButton {
            width: 25px;
            height: 25px;
            margin-left: 0px;
            margin-right: 0px;
            background-color: #dddddd;
            border-style: solid;
            border-color: grey;
            border-width: 1px;
            cursor: pointer;
            background-size: cover;
        }

        img.urlJumpIcon {
            width: 15px;
            height: 15px;
        }

        .statusInput {
            width: 50px;
        }

        th.param {
            font-size: 11px;
            background-color: #ffffff;
            padding: 0px;
            text-align: center;
        }

        td.param {
            min-width: 40px;
            text-align: center;
            font-size: 11px;
        }

        input.numeric {
            width: 40px;
        }

        input.numericFloat {
            width: 50px;
        }

        .normal {
            font-size: 11px;
        }

        tr.attackInfo {
            border: solid;
            border-width: 10px;
            padding: 0px;
            margin: 0px;
        }

        td.ally {
            background-color: cadetblue;
            color: gold;
            font-size: 8px;
            border: solid;
            border-color: lightblue;
            border-width: 1px;
        }

        td.enemy {
            background-color: rgb(177, 55, 55);
            color: gold;
            font-size: 8px;
            border: solid;
            border-color: lightpink;
            border-width: 1px;
        }

        select.hero {
            width: 160px;
        }

        select.blessing {
            width: 140px;
        }

        select.skill {
            width: 160px;
        }

        .debugInfo {
            font-size: 11px;
            /* visibility: hidden; */
        }

        .itemDialog-button {
            width: 200px;
        }

        .dialog-button {
            width: 100px;
        }

        .dialog-button-text {
            font-size: 14px;
        }

        input[type="checkbox"].fehButton {
            display: none;
        }

        input[class="fehButton"]:checked+label {
            filter: grayscale(0%);
        }

        input[class="fehButton"]:not(:checked)+label {
            filter: grayscale(100%);
        }
    </style>

    <!-- 重要なところは予め接続 -->
    <link rel="preconnect" href="//cdnjs.cloudflare.com">
    <link rel="preconnect" href="//code.jquery.com">

    <div id="app">
        <table style="border-style: none;">
            <tr>
                <td valign="top">
                    <div class="jquery" id="unitSettings">
                        <unit-detail v-model="allyUnits[0]"></unit-detail>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <div style="float:right">
                        <input id="debugMenuEnabled" type="checkbox" v-model="isDebugMenuEnabled"
                            @change="debugMenuEnabledChanged"><label class="normal"
                            for="debugMenuEnabled">デバッグモード有効(開発者用)</label>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <span style="font-size:12px"><b>デバッグログ</b></span>
                    <input id="showDetailLog" type="checkbox" v-model="showDetailLog"
                        @change="showDetailLogChanged"><label class="normal" for="showDetailLog">詳細ログを出力</label>
                    <input type="button" @click="g_app.clearLog()" value="クリア" style="font-size: 8px;" />
                    <input type="button" @click="copyDebugLogToClipboard()" value="コピー" style="font-size: 8px;" />
                    <div v-html="damageCalcLog" id="debugLogPanel"
                        style="height: 400px; border: 1px solid #dddddd;background-color: #ffffff;overflow-y: scroll;">
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <style>
        .select2-results__options {
            font-size: 12px;
        }

        .select2-selection__rendered {
            font-size: 12px;
        }
    </style>
    <script type="text/x-template" id="unit-detail-template">
        <table border='0' style='border-width: 0px;border-style:none;'>
            <tr>
                <td>
                    <table border='0' style='border-width: 0px;border-style:none;'>
                        <tr>
                            <td>
                                <img v-bind:src="value.icon" width="50" height="50" />
                                <select2 :options="g_app.vm.heroOptions" v-model="value.heroIndex" class="hero"
                                    @input="g_app.vm.heroIndexChanged">
                                </select2>
                                <a v-bind:href="value.detailPageUrl" target="_blank" v-if="value.heroIndex >= 0">
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>
                                <span class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >({{value.heroIndex}})</span>
                                <br/>
                                ★
                                <select v-model="value.rarity" @change="g_app.vm.ivChanged">
                                    <option v-for="item in UnitRarity" v-bind:value="item">
                                        {{ item}}
                                    </option>
                                </select>
                                <label class="normal" for="merge">LV.</label>
                                <input name="level" type="number" v-model="value.level"
                                    min="1" max="99" class="numeric" @input="g_app.vm.mergeChanged" />
                                +<input name="merge" type="number" v-model="value.merge"
                                    min="0" max="10" class="numeric" @input="g_app.vm.mergeChanged" />
                                <label class="normal" for="dragonflower">
                                    <img v-bind:src="value.dragonflowerIcon" width="25" height="25" />
                                +</label>
                                <input name="dragonflower" type="number"
                                    v-model="value.dragonflower" min="0" v-bind:max="value.maxDragonflower"
                                    class="numeric" @input="g_app.vm.dragonflowerChanged" />
                            </td>
                        </tr>
                        <tr  v-bind:style="g_app.vm.debugMenuStyle">
                            <td>
                                id={{value.id}} 
                                <label  class="normal" for="slotOrder">スロット番号: </label>
                                <input   name="slotOrder" type="number" min="0" max="5" readonly="readonly"
                                    v-model="value.slotOrder" class="statusInput"
                                    @input="g_app.vm.slotOrderChanged" />
                                <span class="debugInfo">
                                    <label class="normal" for="moveCount">移動値: </label>
                                    <input name="moveCount" type="number" readonly="readonly"
                                        v-model="value.moveCount" class="statusInput"
                                        @input="g_app.vm.moveCountChanged" />({{value.moveCountAtBeginningOfTurn}})
                                </span>
                                <label class="debugInfo" class="normal" for="moveCountAtBeginningOfTurn">ターン開始時の移動値: </label>
                                <input class="debugInfo" name="moveCountAtBeginningOfTurn" type="number" readonly="readonly"
                                    v-model="value.moveCountAtBeginningOfTurn" class="statusInput"
                                   />
                                <span v-if="value.heroInfo != null">
                                <label  class="normal" for="origin">出典: </label>{{ value.heroInfo.origin }}
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span v-if="value.groupId == UnitGroupType.Ally">
                                    <label class="normal" >召喚士との絆: </label>
                                    <select v-model="value.summonerLevel" @change="g_app.vm.summonerLevelChanged">
                                        <option v-for="option in g_appData.summonerLevelOptions" v-bind:value="option.id">
                                            {{ option.text }}
                                        </option>
                                    </select>
                                </span>
                                <span v-if="value.providableBlessingSeason == SeasonType.None">
                                    <label class="normal" for="grantedBlessing">祝福: </label>
                                    <select v-model="value.grantedBlessing" @change="g_app.vm.grantedBlessingChanged">
                                        <option v-for="option in g_appData.seasonOptions" v-bind:value="option.id">
                                            {{ option.text }}
                                        </option>
                                    </select>
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label class="normal" for="ivHigh">得意: </label>
                                <select v-model="value.ivHighStat" @change="g_app.vm.ivChanged">
                                    <option v-for="option in IvStateOptions" v-bind:value="option.id">
                                        {{ option.text }}
                                    </option>
                                </select>
                                <label class="normal" for="ivLow">苦手: </label>
                                <select v-model="value.ivLowStat" @change="g_app.vm.ivChanged">
                                    <option v-for="option in IvStateOptions" v-bind:value="option.id">
                                        {{ option.text }}
                                    </option>
                                </select>
                                <label class="normal"><img
                                        src="/AetherRaidTacticsBoard/images/AscendedFloret.png" width="20"
                                        height="20"></label>
                                <select v-model="value.ascendedAsset" @change="g_app.vm.ivChanged">
                                    <option v-for="option in IvStateOptions" v-bind:value="option.id">
                                        {{ option.text }}
                                    </option>
                                </select>
                                <br/>
                                <input v-bind:id='"isBonusChar"+value.id' type="checkbox" v-model="value.isBonusChar" @change="g_app.vm.isBonusCharChanged" />
                                <label class="normal" v-bind:for='"isBonusChar"+value.id'>ボナ補正</label>
                                <span v-if="value.heroInfo!=null && value.heroInfo.isResplendent">
                                <input v-bind:id='"isResplendent"+value.id' type="checkbox" v-model="value.isResplendent" @change="g_app.vm.isBonusCharChanged" />
                                <label class="normal" v-bind:for='"isResplendent"+value.id'>神装</label>
                                </span>
                            </td>
                        </tr>
                        <tr v-bind:style="g_app.vm.debugMenuStyle">
                            <td>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <table border='0' style='border-width: 0px;border-style:none;'>
                        <tr>
                            <td colspan="7">
                                <label class="normal" for="currentUnitHp">HP: </label>
                                <input name="currentUnitHp" type="number" min="0" @input="g_app.vm.hpChanged"
                                    v-bind:max="value.maxHpWithSkills"
                                    v-model="value.hp" class="numeric" />/
                                <!-- <input type="number" v-model="value.maxHpWithSkills"
                                    min="1" class="numeric" /> -->
                                {{value.maxHpWithSkills}}
                                <span
                                    style="font-size:11px">({{value.hpPercentage}}%)</span>

                                <input type="button" value='全回復' class="buttonUi"
                                    @click="g_app.vm.healHpFull" v-bind:style="g_app.vm.debugMenuStyle">
                                <input type="button" value='ステータス初期化' class="buttonUi"
                                    @click="g_app.__updateStatusBySkillsAndMerges(value);" v-bind:style="g_app.vm.debugMenuStyle">
                                <input v-if="g_appData.gameMode == GameMode.ResonantBattles" type="button" value="双界の敵ステータス設定..." style="width:140px" class="buttonUi" @click="$('#setupResonantBattleEnemyDialog').dialog('open');">
                            </td>
                        </tr>
                        <tr>
                            <th class='param'>
                            </th>
                            <th class='param'>
                                
                            </th>
                            <th class='param'>
                                強化
                            </th>
                            <th class='param'>
                                弱化
                            </th>
                            <th class='param'>
                                合計
                            </th>
                            <th class='param' v-bind:style="g_app.vm.debugMenuStyle">成長率</th>
                        </tr>
                        <tr>
                            <th class='param'>
                                HP
                            </th>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.atkWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.maxHpWithSkillsWithoutAdd}}
                            </td>
                            <td class='param'>
                            </td>
                            <td class='param'>
                            </td>
                            <td class='param'>
                                {{value.maxHpWithSkills}}
                            </td>
                            <td class='param' v-bind:style="g_app.vm.debugMenuStyle">
                                <input class='numericFloat' v-model="value.hpGrowthRate" @change="g_app.__updateStatusBySkillsAndMerges(value, false)" type="number" min="0" max="2" step="0.05">
                            </td>
                        </tr>
                        <tr>
                            <th class='param'>
                                攻
                            </th>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.atkWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.atkWithSkills-value.atkAdd}}
                            </td>
                            <td class='param'>
                                <input class='numeric' v-model=" value.atkBuff" @change="g_app.vm.buffChanged"
                                    type="number" min="-99" max="99" step="1">
                            </td>
                            <td class='param'><input class='numeric'
                                    v-model="value.atkDebuff" type="number" min="-99" @change="g_app.vm.buffChanged"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                {{value.getAtkInCombat()}}
                            </td>
                            <td class='param' v-bind:style="g_app.vm.debugMenuStyle">
                                <input class='numericFloat' v-model="value.atkGrowthRate" @change="g_app.__updateStatusBySkillsAndMerges(value, false)" type="number" min="0" max="2" step="0.05">
                            </td>
                        </tr>
                        <tr>
                            <th class='param'>
                                速
                            </th>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.spdWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.spdWithSkills-value.spdAdd}}
                            </td>
                            <td class='param'>
                                <input class='numeric' v-model="value.spdBuff" @change="g_app.vm.buffChanged"
                                    type="number" min="-99" max="99" step="1">
                            </td>
                            <td class='param'><input class='numeric' @change="g_app.vm.buffChanged"
                                    v-model="value.spdDebuff" type="number" min="-99"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                {{value.getSpdInCombat()}}
                            </td>
                            <td class='param' v-bind:style="g_app.vm.debugMenuStyle">
                                <input class='numericFloat' v-model="value.spdGrowthRate" @change="g_app.__updateStatusBySkillsAndMerges(value, false)" type="number" min="0" max="2" step="0.05">
                            </td>
                        </tr>
                        <tr>
                            <th class='param'>
                                守
                            </th>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.defWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.defWithSkills-value.defAdd}}
                            </td>
                            <td class='param'>
                                <input class='numeric' v-model="value.defBuff" @change="g_app.vm.buffChanged"
                                    type="number" min="-99" max="99" step="1">
                            </td>
                            <td class='param'><input class='numeric' @change="g_app.vm.buffChanged"
                                    v-model="value.defDebuff" type="number" min="-99"
                                    max="99" step="1">
                            </td>

                            <td class='param'>
                                {{value.getDefInCombat()}}
                            </td>
                            <td class='param' v-bind:style="g_app.vm.debugMenuStyle">
                                <input class='numericFloat' v-model="value.defGrowthRate" @change="g_app.__updateStatusBySkillsAndMerges(value, false)" type="number" min="0" max="2" step="0.05">
                            </td>

                        </tr>
                        <tr>
                            <th class='param'>
                                魔
                            </th>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.resWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.resWithSkills-value.resAdd}}
                            </td>
                            <td class='param'>
                                <input class='numeric' v-model="value.resBuff" @change="g_app.vm.buffChanged"
                                    type="number" min="-99" max="99" step="1">
                            </td>
                            <td class='param'><input class='numeric' @change="g_app.vm.buffChanged"
                                    v-model="value.resDebuff" type="number" min="-99"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                {{value.getResInCombat()}}
                            </td>
                            <td class='param' v-bind:style="g_app.vm.debugMenuStyle">
                                <input class='numericFloat' v-model="value.resGrowthRate" @change="g_app.__updateStatusBySkillsAndMerges(value, false)" type="number" min="0" max="2" step="0.05">
                            </td>
                        </tr>
                        <tr>
                            <td class='param'>
                                計
                            </td>
                            <td class='param'>
                                {{value.maxHpWithSkillsWithoutAdd + value.atkWithSkills+value.atkBuff+value.atkDebuff
                                    +value.spdWithSkills+value.spdBuff+value.spdDebuff
                                    +value.defWithSkills+value.defBuff+value.defDebuff
                                    +value.resWithSkills+value.resBuff+value.resDebuff}}
                            </td>
                            <td colspan="2">
                            </td>
                            <td></td>
                            <td v-bind:style="g_app.vm.debugMenuStyle">
                                <input type="button" value='リセット' class="buttonUi" style="font-size:10px"
                                    @click="value.updatePureGrowthRate();if(g_app.vm.gameMode == GameMode.ResonantBattles && isThief(value)){value.defGrowthRate=0.4;}g_app.__updateStatusBySkillsAndMergeForAllHeroes();">
                            </td>
                        </tr>
                        <tr>
                            <td colspan="7">
                                <div style="padding:5px">
                                    <label class="normal" >状態: </label>
                                    <span v-for="statusEffect in value.statusEffects">
                                        <img v-bind:src="statusEffectTypeToIconFilePath(statusEffect)" style="width:15px" />
                                    </span>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="7">
                                <span v-if="isWeaponTypeBeast(value.weaponType)">
                                    <input v-bind:id='"isTransformed"+value.id' type="checkbox" v-model="value.isTransformed" @change="g_app.vm.mergeChanged" />
                                    <label class="normal" v-bind:for='"isTransformed"+value.id'>化身状態</label>
                                </span>
                            </td>
                        </tr>
                        <tr v-bind:style="g_app.vm.debugMenuStyle">
                            <td colspan="7">
                                <input v-bind:id='"isSelected"+value.id' type="checkbox" v-model="value.isSelected" />
                                <label class="normal" v-bind:for='"isSelected"+value.id'>選択中</label>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <table border="0" style="border-style:none;">
                        <tr>
                            <th class='param'><img class="weaponIcon" style="max-width:15px" /></th>
                            <td>
                                <select2 :options="g_app.vm.weaponOptions" v-model="value.weapon" v-if="g_app.vm.enableAllSkillOptions"
                                    @input="g_app.vm.weaponChanged" class="skill">
                                </select2>
                                <select2 :options="value.heroInfo.weaponOptions" v-model="value.weapon" v-bind:name="value.id+'-weapon'" v-else-if="value.heroInfo!=null"
                                    @input="g_app.vm.weaponChanged" class="skill">
                                </select2>
                                <a v-bind:href="value.weaponInfo.detailPageUrl" target="_blank" v-if="value.weaponInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>

                                <span class="debugInfo"  v-bind:style="g_app.vm.debugMenuStyle">
                                    ({{value.weapon}}) {{value.heroInfo!=null?value.heroInfo.weaponOptions.length:0}}, {{g_appData.weaponImplCount}}/{{g_appData.weaponCount}}({{Math.floor(100*g_appData.weaponImplCount/g_appData.weaponCount, 2)}}%)
                                </span>
                                <select v-model="value.weaponRefinement" @change="g_app.vm.weaponOptionChanged" v-if="g_app.vm.enableAllSkillOptions">
                                    <option v-for="option in g_appData.weaponRefinementOptions" v-bind:value="option.id">
                                        {{ option.text }}
                                    </option>
                                </select>
                                <select v-model="value.weaponRefinement" @change="g_app.vm.weaponOptionChanged" v-else-if="value.weaponInfo != null&&value.weaponInfo.weaponRefinementOptions.length > 1">
                                    <option v-for="option in value.weaponInfo.weaponRefinementOptions" v-bind:value="option.id">
                                        {{ option.text }}
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th class='param'><img class="supportIcon" style="max-width:15px" />
                            </th>
                            <td>
                                <select2 :options="g_app.vm.supportOptions" v-if="g_app.vm.enableAllSkillOptions"
                                @input="g_app.vm.supportChanged"
                                    v-model="value.support" class="skill">
                                </select2>
                                <select2 :options="value.heroInfo.supportOptions" v-else-if="value.heroInfo!=null"
                                @input="g_app.vm.supportChanged"
                                 v-bind:name="value.id+'-support'"
                                    v-model="value.support" class="skill">
                                </select2>
                                <a v-bind:href="value.supportInfo.detailPageUrl" target="_blank" v-if="value.supportInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>

                                <span class="debugInfo"  v-bind:style="g_app.vm.debugMenuStyle">
                                    ({{value.support}}) {{value.heroInfo!=null?value.heroInfo.supportOptions.length:0}}, {{g_appData.supportImplCount}}/{{g_appData.supportCount}}({{Math.floor(100*g_appData.supportImplCount/g_appData.supportCount, 2)}}%)</span>
                            </td>
                        </tr>
                        <tr>
                            <th class='param'><img class="specialIcon" style="max-width:15px" />
                            </th>
                            <td>
                                <select2 :options="g_app.vm.specialOptions" v-model="value.special" v-if="g_app.vm.enableAllSkillOptions"
                                    @input="g_app.vm.specialChanged" class="skill">
                                </select2>
                                <select2 :options="value.heroInfo.specialOptions" v-model="value.special" v-bind:name="value.id+'-special'" v-else-if="value.heroInfo!=null"
                                    @input="g_app.vm.specialChanged" class="skill">
                                </select2>
                                <a v-bind:href="value.specialInfo.detailPageUrl" target="_blank" v-if="value.specialInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>

                                <span class="debugInfo"  v-bind:style="g_app.vm.debugMenuStyle">
                                    ({{value.special}}) {{value.heroInfo!=null?value.heroInfo.specialOptions.length:0}}, {{g_appData.specialImplCount}}/{{g_appData.specialCount}}({{Math.floor(100*g_appData.specialImplCount/g_appData.specialCount, 2)}}%)</span>
                                <span v-if="value.special >= 0">
                                <input name="currentUnitSpecial" type="number" min="0" v-bind:max="value.maxSpecialCount" 
                                    v-model="value.specialCount" class="numeric" @input="g_app.vm.specialCountChanged" /> / {{value.maxSpecialCount}}
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <th class='param'><span style="color:rgb(224, 19, 19)">A</span></th>
                            <td>
                                <select2 :options="g_app.vm.passiveAOptions"  v-if="g_app.vm.enableAllSkillOptions"
                                    v-model="value.passiveA" @input="g_app.vm.passiveAChanged" class="skill">
                                </select2>
                                <select2 :options="value.heroInfo.passiveAOptions" v-bind:name="value.id+'-passiveA'" v-else-if="value.heroInfo!=null"
                                    v-model="value.passiveA" @input="g_app.vm.passiveAChanged" class="skill">
                                </select2>
                                <a v-bind:href="value.passiveAInfo.detailPageUrl" target="_blank" v-if="value.passiveAInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>

                                <span class="debugInfo"  v-bind:style="g_app.vm.debugMenuStyle">
                                    ({{value.passiveA}}) {{value.heroInfo!=null?value.heroInfo.passiveAOptions.length:0}}, {{g_appData.passiveAImplCount}}/{{g_appData.passiveACount}}({{Math.floor(100*g_appData.passiveAImplCount/g_appData.passiveACount, 2)}}%)</span>
                            </td>
                        </tr>
                        <tr>
                            <th class='param'><span style="color:rgb(28, 28, 209)">B</span></th>
                            <td>
                                <select2 :options="g_app.vm.passiveBOptions"  v-if="g_app.vm.enableAllSkillOptions"
                                    v-model="value.passiveB" class="skill" @input="g_app.vm.passiveBChanged">
                                </select2>
                                <select2 :options="value.heroInfo.passiveBOptions" v-bind:name="value.id+'-passiveB'" v-else-if="value.heroInfo!=null"
                                    v-model="value.passiveB" class="skill" @input="g_app.vm.passiveBChanged">
                                </select2>
                                <a v-bind:href="value.passiveBInfo.detailPageUrl" target="_blank" v-if="value.passiveBInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>

                                <span class="debugInfo"  v-bind:style="g_app.vm.debugMenuStyle">
                                    ({{value.passiveB}}) {{value.heroInfo!=null?value.heroInfo.passiveBOptions.length:0}}, {{g_appData.passiveBImplCount}}/{{g_appData.passiveBCount}}({{Math.floor(100*g_appData.passiveBImplCount/g_appData.passiveBCount, 2)}}%)</span>
                            </td>
                        </tr>
                        <tr>
                            <th class='param'><span style="color:rgb(118, 175, 4)">C</span></th>
                            <td>
                                <select2 :options="g_app.vm.passiveCOptions" v-if="g_app.vm.enableAllSkillOptions"
                                    v-model="value.passiveC" @input="g_app.vm.passiveCChanged" class="skill">
                                </select2>
                                <select2 :options="value.heroInfo.passiveCOptions" v-bind:name="value.id+'-passiveC'" v-else-if="value.heroInfo!=null"
                                    v-model="value.passiveC" @input="g_app.vm.passiveCChanged" class="skill">
                                </select2>
                                <a v-bind:href="value.passiveCInfo.detailPageUrl" target="_blank" v-if="value.passiveCInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>

                                <span class="debugInfo"  v-bind:style="g_app.vm.debugMenuStyle">
                                    ({{value.passiveC}}) {{value.heroInfo!=null?value.heroInfo.passiveCOptions.length:0}}, {{g_appData.passiveCImplCount}}/{{g_appData.passiveCCount}}({{Math.floor(100*g_appData.passiveCImplCount/g_appData.passiveCCount, 2)}}%)</span>
                            </td>
                        </tr>
                        <tr>
                            <th class='param'><span style="color:rgb(255, 157, 0);">S</span>
                            </th>
                            <td>
                                <select2 :options="g_app.vm.passiveSOptions" v-if="g_app.vm.enableAllSkillOptions"
                                    v-model="value.passiveS" @input="g_app.vm.passiveSChanged" class="skill">
                                </select2>
                                <select2 :options="value.heroInfo.passiveSOptions" v-bind:name="value.id+'-passiveS'" v-else-if="value.heroInfo!=null"
                                    v-model="value.passiveS" @input="g_app.vm.passiveSChanged" class="skill">
                                </select2>
                                <a v-bind:href="value.passiveSInfo.detailPageUrl" target="_blank" v-if="value.passiveSInfo != null" >
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>

                                <span class="debugInfo"  v-bind:style="g_app.vm.debugMenuStyle">
                                    ({{value.passiveS}}) {{value.heroInfo!=null?value.heroInfo.passiveSOptions.length:0}}, {{g_appData.passiveSImplCount}}/{{g_appData.passiveSCount}}({{Math.floor(100*g_appData.passiveSImplCount/g_appData.passiveSCount, 2)}}%)</span>
                            </td>
                        </tr>
                    </table>
                    <div>
                        <input type="button" value="初期スキル装備" @click="value.clearReservedSkills();value.initializeSkillsToDefault();" >
                        <input type="button" value="全て外す" @click="value.clearReservedSkills();value.clearSkills();" >
                        <input v-if="g_appData.isDebugMenuEnabled" type="button" value="未実装スキルをログ表示" @click="g_app.outputSkillsNotImplemented();" >
                    </div>
                    <div style="padding:5px">
                        <span v-if="(value.isDuoHero) && value.groupId == UnitGroupType.Ally && g_app.canActivateDuoSkillOrHarmonizedSkill(value)">
                            <input type="button"
                                style="background-image: url(https://puarts.com/AetherRaidTacticsBoard/images/ActivateDuoSkill.png)"
                                class="fehButton"
                                 @click="g_app.activateDuoOrHarmonizedSkill(value);">
                        </span>
                        <span v-if="(value.isDuoHero) && value.groupId == UnitGroupType.Ally && !g_app.canActivateDuoSkillOrHarmonizedSkill(value)">
                            <input type="button" v-if="value.isDuoHero " disabled
                                style=" background-image: url(https://puarts.com/AetherRaidTacticsBoard/images/ActivateDuoSkill_Disabled.png)"
                                class="fehButtonDisabled">
                        </span>
                        <span v-if="(value.isHarmonicHero) && value.groupId == UnitGroupType.Ally && g_app.canActivateDuoSkillOrHarmonizedSkill(value)">
                            <input type="button"
                                style="background-image: url(https://puarts.com/AetherRaidTacticsBoard/images/ActivateHarmonizedSkill.png)"
                                class="fehButton"
                                 @click="g_app.activateDuoOrHarmonizedSkill(value);">
                        </span>
                        <span v-if="(value.isHarmonicHero) && value.groupId == UnitGroupType.Ally && !g_app.canActivateDuoSkillOrHarmonizedSkill(value)">
                            <input type="button" v-if="value.isHarmonicHero" disabled
                                style=" background-image: url(https://puarts.com/AetherRaidTacticsBoard/images/ActivateHarmonizedSkill_Disabled.png)"
                                class="fehButtonDisabled">
                        </span>
                    </div>
                    <fieldset v-if="g_appData.gameMode == GameMode.Arena"  style="font-size:12px;">
                        <legend>闘技場スコア</legend>
                        
                        <span>スコア: {{value.arenaScore*2}}({{value.arenaScore}})</span><br/>
                        <span style="color:#555">
                        計算式: (150 + {{value.rarityScore}} + {{value.levelScore}} + ({{value.rating}} / 5) + ({{value.totalSp}} / 100) + ({{value.merge}} * 2)) * 2<br/>
                        総合値: {{value.rating}}<br/>
                        合計SP: {{value.totalSp}}({{value.weaponSp}}+{{value.supportSp}}+{{value.specialSp}}+{{value.passiveASp}}+{{value.passiveBSp}}+{{value.passiveCSp}}+{{value.passiveSSp}})</span><br/>
                        <input type="button" @click="g_app.setUnitToMaxArenaScore(value)" value="最大スコアに設定"></input>
                    </fieldset>
                </td>
            </tr>
        </table>
    </script>

    <script>
        function copyDebugLogToClipboard() {
            selectText("debugLogPanel");
            document.execCommand("copy");
        }
    </script>

    <!-- jquery -->
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

    <!-- select2 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css"
        media="print" onload="this.media='all'">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>

    <!-- jquery-ui -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.min.css" media="print"
        onload="this.media='all'">
    <script async src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <!-- vue.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.13/vue.min.js"></script>

    <!-- sortable.js -->
    <script async src="https://cdn.jsdelivr.net/npm/sortablejs@1.8.4/Sortable.min.js"></script>

    <!-- vuedraggable.js -->
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/2.23.2/vuedraggable.umd.min.js"></script>

    <!-- クッキー(実際は使ってないので消してもいいかも) -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script> -->

    <!-- 文字列圧縮 -->
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

    <!-- 画像解析 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.min.css" media="print"
        onload="this.media='all'">
    <script async type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.min.js"></script>

    <!-- <script defer type="text/javascript" src="https://docs.opencv.org/4.2.0/opencv.js"></script> -->






    <script>
        function createScriptElement(src, onloadFunc) {
            let element = document.createElement("script");
            element.type = "text/javascript";
            element.src = src;
            element.onload = onloadFunc;
            // document.body.appendChild(element);
            let headElement = document.getElementsByTagName('head')[0];
            headElement.appendChild(element);
        }

        function loadScripts(scriptFileNames, allScriptLoaded, index = 0) {
            if (index == scriptFileNames.length) {
                allScriptLoaded();
                return;
            }

            let jsRootPath = "./";
            // jsRootPath = "/AetherRaidTacticsBoard/Release2/";
            let reloadSuffix = "20200513";
            let scriptFileName = scriptFileNames[index];
            let src = jsRootPath + scriptFileName + "?" + reloadSuffix;
            const startTime = Date.now();
            createScriptElement(src, x => {
                const endTime = Date.now();
                console.log(`${endTime - startTime} ms to load ${src}`);
                loadScripts(scriptFileNames, allScriptLoaded, ++index);
            });
        }

        $(function () {
            const startTime = Date.now();
            loadScripts([
                "GlobalDefinitions_Debug.js",
                "Cell.js",
                "Table.js",
                "Utilities.js",
                "Logger.js",
                "Skill.js",
                "Tile.js",
                "Structures.js",
                "HeroInfo.js",
                "Unit.js",
                "UnitManager.js",
                "Map.js",
                "GlobalBattleContext.js",
                "DamageCalculationUtility.js",
                "DamageCalculator.js",
                "PostCombatSkillHander.js",
                "DamageCalculatorWrapper.js",
                "BeginningOfTurnSkillHandler.js",
                "TurnSetting.js",
                "AudioManager.js",
                "AetherRaidDefensePresets.js",
                "SkillDatabase.js",
                "HeroDatabase.js",
                "AppData.js",
                "SettingManager.js",
                "Main_ImageProcessing.js",
                "Main_OriginalAi.js",
                "Main_MouseAndTouch.js",
                "Main.js",
                "VueComponents.js",
                "SampleSkillInfos.js",
                "SampleHeroInfos.js",
            ], () => {
                const endTime = Date.now();
                console.log(`${endTime - startTime} ms to load all scripts`);
                console.log("initializing application");
                g_app.registerSkillOptions(weaponInfos, supportInfos, specialInfos, passiveAInfos, passiveBInfos, passiveCInfos,
                    passiveSInfos);
                g_app.registerHeroOptions(heroInfos);

                loadLazyImages();
            });
        });
        window.addEventListener('load', (event) => {
            let endTime = Date.now();
            let diffTime = endTime - g_startTime;
            g_app.writeDebugLogLine(`ページの初期化: ${diffTime} ms`);
            initAetherRaidBoard(heroInfos);

            let unit = g_appData.allyUnits[0];
            g_app.setCurrentUnit(unit.id);
            g_appData.isDebugMenuEnabled = false;
            g_appData.applyDebugMenuVisibility();
        });
    </script>
</body>