<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>英雄決闘シミュレーター</title>
    <link rel="stylesheet" href="css/main.css?20181201" type="text/css" />
    <link rel="stylesheet" href="AetherRaidTacticsBoard/Release2/feh-battle-simulator.css">
    <link rel="stylesheet" href="feh-battle-simulator.css">
    <script>
        const g_startTime = Date.now();
    </script>
    <script src="Local.js"></script>
    <script>
        // 画像の遅延ロード用の処理。以下の要素を作ると遅延ロードされる
        // <img src="dummy.png" data-src="actual.png" class="lazy" />
        function loadLazyImages() {
            let lazyImages = [].slice.call(document.querySelectorAll("img.lazy"));
            let lazyInputs = [].slice.call(document.querySelectorAll("input.lazy"));
            if ("IntersectionObserver" in window) {
                let lazyImageObserver = new IntersectionObserver(function (entries, observer) {
                    entries.forEach(function (entry) {
                        if (entry.isIntersecting) {
                            let lazyImage = entry.target;
                            if (lazyImage.tagName == "IMG") {
                                lazyImage.src = lazyImage.dataset.src;
                                if (typeof lazyImage.dataset.srcset === "undefined") {
                                } else {
                                    lazyImage.srcset = lazyImage.dataset.srcset;
                                }
                            }
                            else if (lazyImage.tagName == "INPUT") {
                                lazyImage.style.backgroundImage = `url("${lazyImage.dataset.src}")`;
                            }
                            lazyImage.classList.remove("lazy");
                            lazyImageObserver.unobserve(lazyImage);
                        }
                    });
                });

                lazyImages.forEach(function (lazyImage) {
                    lazyImageObserver.observe(lazyImage);
                });
                lazyInputs.forEach(function (lazyInput) {
                    lazyImageObserver.observe(lazyInput);
                });
            } else {
                // Possibly fall back to a more compatible method here
            }
        }
    </script>
</head>

<body>
    <p>
        英雄決闘をシミュレートできるツールです。
    </p>

    <!-- 重要なところは予め接続 -->
    <link rel="preconnect" href="//cdnjs.cloudflare.com">
    <link rel="preconnect" href="//code.jquery.com">

    <div id="app">
        <flash-message
                :flash-messages="flashMessages"
                :remove-flash="removeFlash"
        >
        </flash-message>
        <table style="border-style: none;">
            <tr>
                <td style="width: 450px" valign="top">
                    <table style="border-width: 0px;border-style: none;">
                        <tr>
                            <td>
                                <label>地形:</label>
                            </td>
                            <td>
                                <select v-model="mapKind" v-on:change="mapChanged"
                                    v-if="gameMode == GameMode.AetherRaid">
                                    <option v-for="option in mapKindOptions" v-bind:value="option.value">
                                        {{ option.label }}
                                    </option>
                                </select>
                                <select v-model="mapKind" v-on:change="mapChanged" v-if="gameMode == GameMode.Arena">
                                    <option v-for="option in ArenaMapKindOptions" v-bind:value="option.value">
                                        {{ option.label }}
                                    </option>
                                </select>
                                <select v-model="mapKind" v-on:change="mapChanged"
                                    v-if="gameMode == GameMode.ResonantBattles">
                                    <option v-for="option in ResonantBattlesMapKindOptions" v-bind:value="option.value">
                                        {{ option.label }}
                                    </option>
                                </select>
                                <select v-model="mapKind" v-on:change="mapChanged"
                                    v-if="gameMode == GameMode.TempestTrials">
                                    <option v-for="option in TempestTrialsMapKindOptions" v-bind:value="option.value">
                                        {{ option.label }}
                                    </option>
                                </select>
                                <select v-model="mapKind" v-on:change="mapChanged"
                                    v-if="gameMode == GameMode.SummonerDuels">
                                    <option v-for="option in SummonerDuelsMapKindOptions" v-bind:value="option.value">
                                        {{ option.label }}
                                    </option>
                                </select>
                            </td>
                        </tr>
                        <tr v-if="gameMode == GameMode.ResonantBattles">
                            <td><label>双位:</label></td>
                            <td>
                                <input type="number" v-model="resonantBattleInterval" min="1" max="21"
                                    @change="resonantBattleIntervalChanged">
                            </td>
                        </tr>
                        <tr v-if="gameMode != GameMode.TempestTrials">
                            <td>
                                シーズン:
                            </td>
                            <td>
                                <input id="isLightSeason" type="checkbox" v-model="globalBattleContext.isLightSeason"
                                    @change="lightSeasonChanged"><label class="normal" for="isLightSeason"><img
                                        :src="g_imageRootPath + 'Season_Light.png'" />
                                    <img :src="g_imageRootPath + 'Season_Dark.png'" /></label>
                                <input id="isAstraSeason" type="checkbox" v-model="globalBattleContext.isAstraSeason"
                                    @change="astraSeasonChanged"><label class="normal" for="isAstraSeason"><img
                                        :src="g_imageRootPath + 'Season_Astra.png'" />
                                    <img :src="g_imageRootPath + 'Season_Anima.png'" /></label>
                                <input id="isFireSeason" type="checkbox" v-model="globalBattleContext.isFireSeason"
                                    @change="seasonChanged"><label class="normal" for="isFireSeason"><img
                                        :src="g_imageRootPath + 'Season_Fire.png'" /></label>
                                <input id="isWaterSeason" type="checkbox" v-model="globalBattleContext.isWaterSeason"
                                    @change="seasonChanged"><label class="normal" for="isWaterSeason"><img
                                        :src="g_imageRootPath + 'Season_Water.png'" /></label>
                                <input id="isWindSeason" type="checkbox" v-model="globalBattleContext.isWindSeason"
                                    @change="seasonChanged">
                                <label class="normal" for="isWindSeason">
                                    <img :src="g_imageRootPath + 'Season_Wind.png'" />
                                </label>
                                <input id="isEarthSeason" type="checkbox" v-model="globalBattleContext.isEarthSeason"
                                    @change="seasonChanged"><label class="normal" for="isEarthSeason"><img
                                        :src="g_imageRootPath + 'Season_Earth.png'" /></label>
                            </td>
                        </tr>
                    </table>
                    <table style="border-width: 0px">
                        <tr>
                            <td>
                                <table style="border-style: none;">
                                    <tr>
                                        <td align="center">
                                            <div style="text-align: center;">
                                                <table border="0" align="center"
                                                    style="border-collapse:initial;border-spacing: 0;border-width: 0px; border-style:none">

                                                    <tr class="attackInfo">
                                                        <!-- <td class="ally" rowspan="2" style="width:38px"><img style="width:38px;"
                                                                                        v-bind:src="units[attackerUnitIndex].icon">
                                                                                </td> -->
                                                        <td class="ally summary-text-shadow" align="center"
                                                            v-bind:style="attackInfoTdStyle">
                                                            {{getAttackerName()}}
                                                        </td>
                                                        <!-- <td style="font-size:10px"></td> -->
                                                        <td class="enemy summary-text-shadow" align="center"
                                                            v-bind:style="attackInfoTdStyle">
                                                            {{getAttackTargetName()}}
                                                        </td>
                                                                <!-- <td class="enemy" rowspan="2" style="width:38px"><img style="width:38px;"
                                                                                        v-bind:src="units[attackTargetUnitIndex].icon"></td> -->
                                                    </tr>
                                                    <tr class="attackInfo"
                                                        :style="{'height': isDebugMenuEnabled ? '90px' : '90px'}">
                                                        <td class="ally" align="center">
                                                            <div v-html="attackerInfo"></div>
                                                        </td>
                                                        <!-- <td style="font-size:10px" align="center">HP</td> -->
                                                        <td class="enemy" align="center">
                                                            <div v-html="attackTargetInfo"></div>
                                                        </td>
                                                    </tr>
                                                    <!-- <tr class="attackInfo">
                                                                                <td class="ally" align="center">0 x 2</td>
                                                                                <td style="font-size:10px" align="center">攻撃</td>
                                                                                <td class="enemy" align="center">0 x 2</td>
                                                                            </tr> -->
                                                </table>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style="position: relative;">
                                                <img v-bind:src="g_imageRootPath + 'SummonerDuelsPointDisplay.png'">
                                                <!-- 隊長スキルアイコン -->
                                                <img v-if="g_appData.findAllyCaptain().captainInfo != null"
                                                    v-bind:src="g_appData.findAllyCaptain().captainInfo.iconPath"
                                                    class="captainSkillIcon" style="left:135px" />
                                                <img v-else v-bind:src="g_imageRootPath + 'UnknownCaptainSkill.webp'"
                                                    class="captainSkillIcon" style="left:135px" />
                                                <img v-if="g_appData.findEnemyCaptain().captainInfo != null"
                                                    v-bind:src="g_appData.findEnemyCaptain().captainInfo.iconPath"
                                                    class="captainSkillIcon" style="right:135px" />
                                                <img v-else v-bind:src="g_imageRootPath + 'UnknownCaptainSkill.webp'"
                                                    class="captainSkillIcon" style="right:135px" />

                                                <!-- 撃破スコア -->
                                                <div
                                                    style="position:absolute;top:0px;left:38px;color: #49f;font-size: 18px;">
                                                    {{globalBattleContext.summonerDuelsKoScores[UnitGroupType.Ally]}}
                                                </div>
                                                <div
                                                    style="position:absolute;top:0px;right:90px;color: #f99;font-size: 18px;">
                                                    {{globalBattleContext.summonerDuelsKoScores[UnitGroupType.Enemy]}}
                                                </div>
                                                <!-- 制圧スコア -->
                                                <div
                                                    style="position:absolute;top:0px;left:calc(38px + 63px);color: #49f;font-size: 18px;">
                                                    {{globalBattleContext.summonerDuelsCaptureScores[UnitGroupType.Ally]}}
                                                </div>
                                                <div
                                                    style="position:absolute;top:0px;right:calc(90px - 63px);color: #f99;font-size: 18px;">
                                                    {{globalBattleContext.summonerDuelsCaptureScores[UnitGroupType.Enemy]}}
                                                </div>
                                            </div>
                                            <div style="position: relative;">
                                                <div id="mapArea"></div>
                                                <div class="mapMessage"
                                                    style="position:absolute;top:20px;left:35px;color: #ddd;font-size: 27px;">
                                                    {{globalBattleContext.currentTurn}}
                                                </div>
                                                <div class="mapMessage"
                                                    style="position:absolute;top:50px;left:38px;color: #ddd;font-size: 13px;">
                                                    {{g_appData.maxTurn}}
                                                </div>
                                                <div v-if="isDisplayingMapMessage">
                                                    <img v-bind:src="g_imageRootPath + 'SummonerDuelsTurnDisplay.png'"
                                                        style="position:absolute;top:130px;left:0px">
                                                    <div class="mapMessage"
                                                        style="position:absolute;top:163px;right:107px;color: #ddd;font-size: 30px;">
                                                        {{globalBattleContext.currentTurn}}
                                                    </div>
                                                    <div class="mapMessage"
                                                        v-if="globalBattleContext.currentPhaseType == UnitGroupType.Ally"
                                                        style="position:absolute;top:223px;left:127px;color: #49f;;font-size: 13px;">
                                                        青軍が先行です
                                                    </div>
                                                    <div v-else class="mapMessage"
                                                        style="position:absolute;top:223px;left:127px;color: #f99;font-size: 13px;">
                                                        赤軍が先行です
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <td style="vertical-align:top;">
                                <table style="border-style: none;">
                                    <tr>
                                        <td colspan="1">
                                            <div id="trashArea" class="droppable-elem"
                                                style="border-width: 2px; background-color:#eee;width:192px;min-height: 128px; background-image: url('/AetherRaidTacticsBoard/images/tempArea.png');background-repeat: no-repeat; background-position: center;"
                                                ondragover="f_dragover(event)" ondrop="f_drop(event)"></div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="1">
                                            <input type="button" @click="g_app.clearSimpleLog()" value="クリア"
                                                style="font-size: 8px;" />
                                            <input type="button" @click="copySimpleLogToClipboard()" value="コピー"
                                                style="font-size: 8px;" />
                                            <div v-html="simpleLog" id="simpleLogPanel"
                                                style="overflow-y:scroll; margin-bottom: 5px; height: 130px; width:190px; border: 1px solid #ddd;background-color: #fff;">
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td align="center">
                                            <table style="margin-top:5px;margin-bottom:10px;border-style: none;">
                                                <tr>
                                                    <td>
                                                        <span v-if="globalBattleContext.currentTurn > 0">
                                                            <input type="button"
                                                                style="background-image: url(/AetherRaidTacticsBoard/images/BackToZeroTurn.png) "
                                                                class="playerButton imageButton"
                                                                @click="g_app.backToZeroTurn();" />
                                                            <input type="button"
                                                                style="background-image: url(/AetherRaidTacticsBoard/images/BackTurn.png) "
                                                                class="playerButton imageButton"
                                                                @click="g_app.backCurrentTurn();" />
                                                        </span>
                                                    </td>
                                                    <td style="padding-left:10px;padding-right: 10px;">
                                                        <span style="font-size:12px;font-weight: bold;">
                                                            <span
                                                                v-if="globalBattleContext.currentTurn > 0 && globalBattleContext.currentPhaseType == UnitGroupType.Ally"
                                                                style="color:blue;">Player Phase</span>
                                                            <span
                                                                v-if="globalBattleContext.currentTurn > 0 && globalBattleContext.currentPhaseType == UnitGroupType.Enemy"
                                                                style="color:red;">Enemy Phase</span>
                                                            <br /><span v-if="globalBattleContext.currentTurn > 0"
                                                                style="color:blue;">残り手番
                                                                {{globalBattleContext.restOfPhaseCounts[UnitGroupType.Ally]}}
                                                                /
                                                                {{6}}</span><br /><span
                                                                v-if="globalBattleContext.currentTurn > 0"
                                                                style="color:red;">残り手番
                                                                {{globalBattleContext.restOfPhaseCounts[UnitGroupType.Enemy]}}
                                                                /
                                                                {{6}}</span>
                                                            <span v-if="globalBattleContext.currentTurn == 0">
                                                                <input type="button"
                                                                    style="width: 140px;height:34px; background-color: #ffffff; border-style: none;
                                                                            background-size:cover;background-image: url(/AetherRaidTacticsBoard/images/StartBattle.png) ;cursor: pointer;"
                                                                    class="buttonUi imageButton"
                                                                    @click="g_app.clearLog();g_app.simulateBeginningOfTurn();g_app.__executeAllCommands(g_app.commandQueuePerAction, 0);updateAllUi();">
                                                            </span>
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <span v-if="globalBattleContext.currentTurn > 0">
                                                            <input type="button"
                                                                style="background-image: url(/AetherRaidTacticsBoard/images/GainTurn.png) "
                                                                class="playerButton imageButton"
                                                                onclick="g_app.gainCurrentTurn()" />
                                                        </span>
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="3" align="right">
                                            <span v-if="isCommandUndoable">
                                                <span v-if="commandQueuePerAction.isUndoable">
                                                    <input type="button"
                                                        style="background-image: url(/images/dummy.png) "
                                                        data-src="/AetherRaidTacticsBoard/images/Undo.png"
                                                        class="lazy menuButton imageButton"
                                                        onclick="g_app.undoCommand()" />
                                                </span>
                                                <span v-if="!commandQueuePerAction.isUndoable">
                                                    <input type="button"
                                                        style="filter:brightness(50%);cursor:auto;background-image: url(/images/dummy.png)"
                                                        data-src="/AetherRaidTacticsBoard/images/Undo.png"
                                                        class="lazy menuButton" onclick="" />
                                                </span>
                                                <span v-if="commandQueuePerAction.isRedoable">
                                                    <input type="button"
                                                        style="background-image: url(/images/dummy.png)"
                                                        data-src="/AetherRaidTacticsBoard/images/Redo.png"
                                                        class="lazy menuButton imageButton"
                                                        onclick="g_app.redoCommand()" />
                                                </span>
                                                <span v-if="!commandQueuePerAction.isRedoable">
                                                    <input type="button"
                                                        style="filter:brightness(50%);cursor:auto;background-image: url(/images/dummy.png)"
                                                        data-src="/AetherRaidTacticsBoard/images/Redo.png"
                                                        class="lazy menuButton" onclick="" />
                                                </span>

                                                <span style="padding-left:10px">

                                                    <span v-if="commandQueuePerAction.isRedoable">
                                                        <input type="button"
                                                            style="background-image: url(/images/dummy.png)"
                                                            data-src="/AetherRaidTacticsBoard/images/RedoAll.png"
                                                            class="menuButton" onclick="g_app.redoAllCommand()" />
                                                    </span>
                                                    <span v-if="!commandQueuePerAction.isRedoable">
                                                        <input type="button"
                                                            style="filter:brightness(50%);cursor:auto; background-image: url(/images/dummy.png) "
                                                            data-src="/AetherRaidTacticsBoard/images/RedoAll.png"
                                                            class="lazy menuButton" onclick="" />
                                                    </span>
                                                </span>

                                            </span>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div id="progress" style="height:5px;"></div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <div class="buttonUi">
                                    <control-buttons
                                            :get-app="getApp"
                                            :get-attacker="getAttacker"
                                            :get-current-unit="getCurrentUnit"
                                            :map="map"
                                            :update-map="updateMap"
                                            :end-turn="endTurn"
                                            :save-settings="saveSettings"
                                            :global-battle-context="globalBattleContext"
                                            :show-setting-dialog="showSettingDialog"
                                            :show-import-dialog="showImportDialog"
                                            :show-export-dialog="showExportDialog"
                                            :audio-manager="audioManager"
                                            :bgm-enabled-changed="bgmEnabledChanged"
                                            :load-lazy-images="loadLazyImages"
                                            :show-flash="showFlash"
                                    >
                                    </control-buttons>
                                    <!-- <label for='currentTurnSlider'>現在のターン:</label> -->
                                    <!-- <input type='number' id='currentTurn' v-model='globalBattleContext.currentTurn' min='0' max='7' step='1'
                                        style='width:30px' @change="currentTurnChanged" readonly='readonly' /> -->


                                    <span v-bind:style="debugMenuStyle">
                                        <input id="isAutoLoadEnabled" type="checkbox"
                                            v-model="isAutoLoadTurnSettingEnabled"><label
                                            for="isAutoLoadEnabled">ターン切り替え時に自動復元</label>
                                    </span>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <simulation-controls
                                        :get-app="getApp"
                                        :is-enemy-action-triggered.sync="isEnemyActionTriggered"
                                        :simulates-enemy-action-one-by-one.sync="simulatesEnemyActionOneByOne"
                                        :is-icon-overlay-disabled.sync="map.isIconOverlayDisabled"
                                        :is-trap-icon-overlay-disabled.sync="map.isTrapIconOverlayDisabled"
                                        :is-aether-raid="gameMode == GameMode.AetherRaid"
                                        :is-resonant="GameMode == GameMode.ResonantBattles"
                                        @icon-overlay-disabled-changed="iconOverlayDisabledChanged"
                                        @heal-hp-full="healHpFullForAllUnits"
                                        @reset-placement="resetPlacement"
                                        @open-team-formation-dialog="$('#teamFormationDialog').dialog('open')"
                                        @open-aether-raid-dialog="$('#aetherRaidDefensePresetDialog').dialog('open')"
                                        @open-item-dialog="$('#itemDialog').dialog('open')"
                                        @open-durability-test="$('#durabilityTestDialog').dialog('open')"
                                        @open-edit-map="$('#editMapDialog').dialog('open')"
                                >
                                </simulation-controls>
                            </td>
                        </tr>
                        <tr v-bind:style="debugMenuStyle">
                            <td colspan="2">
                                <debug-buttons
                                        :get-app="getApp"
                                        :reset-unit-random="resetUnitRandom"
                                        :activate-all-unit="activateAllUnit"
                                        :reset-unit-for-testing="resetUnitForTesting"
                                        :open-auto-clear-dialog="() => $('#autoClearDialog').dialog('open')"
                                >
                                </debug-buttons>
                            </td>
                        </tr>
                    </table>
                </td>
                <td valign="top">
                    <!-- <input type="checkbox" id='autoChangeDetail' v-model='autoChangeDetail'><label
                        for='autoChangeDetail' class="normal">アイコン選択時に自動切換え</label><br /> -->
                    <!-- <div class="tabs">
                        <span v-for="(unit, index) in units">
                            <input type="radio" v-bind:id="'tab-'+unit.id" name="tab" v-bind:value="index"
                                v-model="currentUnitIndex">
                            <label v-bind:for="'tab-'+unit.id">{{selectionOptions[index].text}}</label>
                        </span>
                    </div> -->
                    <table border="0" style="border-width: 0px;border-color: #dddddd;margin: 5px;font-size:14px">
                        <tr style="background-color:#bcf;border-style: solid;border-color: #aaf; border-width: 2px;">
                            <td><span style="padding-right: 10px;">青軍</span>
                            </td>
                            <td>
                                <draggable tag="div" @end="enemyUnitSorted">
                                    <button type="button" @click="g_app.selectItem(unit.id)" v-for="unit in allyUnits"
                                        v-bind:class="unit.id + ' iconButton'" style="position:relative">

                                        <span style="font-weight: bold; font-size:12px; position:absolute">
                                            <div v-if="unit.summonerLevel!=SummonerLevel.None" style="color:red; ">
                                                絆{{summonerLevelToString(unit.summonerLevel)}}</div>
                                            <div v-if="unit.isBonusChar"
                                                style=" color:blue;background-color: #ffffff66;">
                                                Bonus</div>
                                        </span>
                                        <span v-if="unit.isCaptain">
                                            <img v-if="g_appData.findAllyCaptain().captainInfo != null"
                                                v-bind:src="g_appData.findAllyCaptain().captainInfo.iconPath" width="25"
                                                height="25" />
                                            <img v-else v-bind:src="g_imageRootPath + 'UnknownCaptainSkill.webp'"
                                                width="25" height="25" />
                                        </span>
                                        <div class="team-container">
                                            <img :key=" unit.id" v-bind:src="unit.icon" class="unit-img" style="max-width: 35px;" />
                                            <img v-if="unit.emblemHeroIndex !== EmblemHero.None" class="engage-img" v-bind:src="EngagedSpecialIcon[unit.emblemHeroIndex]" width="20" />
                                        </div>

                                    </button>
                                    <!-- <img v-for="unit in allyUnits" :key="unit.id" src="/images/dummy.png" v-bind:data-src="unit.icon"
                                        class="lazy" v-bind:name="unit.id" style="max-width: 35px;" /> -->
                                </draggable>
                            </td>
                        </tr>
                        <tr style="background-color:#fcc;border-style: solid;border-color: #faa; border-width: 2px;">
                            <td><span style="padding-right: 10px;">赤軍</span>
                            </td>
                            <td>
                                <draggable tag="div" @end="enemyUnitSorted" style="position:relative">
                                    <button type="button" @click="g_app.selectItem(unit.id)" v-for="unit in enemyUnits"
                                        v-bind:class="unit.id + ' iconButton'" style="position:relative">

                                        <span style="font-weight: bold; font-size:12px; position:absolute">
                                            <div v-if="unit.summonerLevel!=SummonerLevel.None" style="color:red; ">
                                                {{summonerLevelToString(unit.summonerLevel)}}</div>
                                            <div v-if="unit.isBonusChar"
                                                style=" color:blue;background-color: #ffffff66;">
                                                Bonus</div>
                                        </span>
                                        <span v-if="unit.isCaptain">
                                            <img v-if="g_appData.findEnemyCaptain().captainInfo != null"
                                                v-bind:src="g_appData.findEnemyCaptain().captainInfo.iconPath"
                                                width="25" height="25" />
                                            <img v-else v-bind:src="g_imageRootPath + 'UnknownCaptainSkill.webp'"
                                                width="25" height="25" />
                                        </span>
                                        <div class="team-container">
                                            <img :key=" unit.id" v-bind:src="unit.icon" class="unit-img" style="max-width: 35px;" />
                                            <img v-if="unit.emblemHeroIndex !== EmblemHero.None" class="engage-img" v-bind:src="EngagedSpecialIcon[unit.emblemHeroIndex]" width="20" />
                                        </div>
                                    </button>
                                </draggable>
                            </td>
                        </tr>
                    </table>
                    <div>
                        <!-- <input type="file" @change="analyzeImage" multiple="multiple" accept="image/*"> -->
                        <input type="button" value="画像から自動設定..." @click="showOcrSettingDialog();">
                        <input type="button" value="ミョルニル査定計算..." @click="showMjolnirsStrikeSettingDialog();"
                            v-if="gameMode == GameMode.Arena">
                        <input type="button" v-if="gameMode == GameMode.ResonantBattles" value="双界の敵リセット"
                            class="buttonUi" @click="g_app.__setUnitsForResonantBattles()">
                        <input type="button" v-if="gameMode == GameMode.ResonantBattles" value="双界の敵の成長率リセット"
                            class="buttonUi" @click="g_app.__setUnitsForResonantBattles(true)">
                        <input type="button" v-if="gameMode == GameMode.TempestTrials" value="戦渦の敵リセット" class="buttonUi"
                            @click="g_app.__setUnitsForTempestTrials()">
                        <span v-bind:style="debugMenuStyle">currentItemIndex={{currentItemIndex}}</span>
                    </div>
                    <div>
                        {{ocrProgress}}
                    </div>
                    <div class="jquery" id="unitSettings">
                        <ul class="contents">
                            <li v-for="unit in enemyUnits">
                                <div style="margin: 5px;">
                                    <span v-show="unit.canHavePairUpUnit">
                                        <input type="button" value="ダブル前衛を編集" @click="unit.isEditingPairUpUnit = false"
                                            v-if="unit.isEditingPairUpUnit" class="buttonUi">
                                        <span v-if="!unit.isEditingPairUpUnit">
                                            <input type="button" value="ダブル後衛を編集"
                                                @click="unit.isEditingPairUpUnit = true" class="buttonUi">
                                        </span>
                                    </span>
                                    <input type="button" class="buttonUi" style="width:95px"
                                           @click="showSaveUnitDialog()"
                                           value="保存・読み込み">
                                    <input type="button" class="buttonUi" style="width:80px"
                                           @click="g_appData.copyCurrentUnit()"
                                           value="コピー">
                                    <input type="button" class="buttonUi" style="width:80px"
                                           @click="g_appData.pasteToCurrentUnit();" value="ペースト">
                                </div>
                                <unit-detail v-model="unit" v-if="!unit.canHavePairUpUnit || !unit.isEditingPairUpUnit">
                                </unit-detail>
                                <unit-detail v-model="unit.pairUpUnit"
                                    v-show="unit.canHavePairUpUnit && unit.isEditingPairUpUnit"></unit-detail>
                            </li>
                            <li v-for="unit in allyUnits">
                                <div style="margin: 5px;">
                                    <span v-show="unit.canHavePairUpUnit">
                                        <input type="button" value="ダブル前衛を編集" @click="unit.isEditingPairUpUnit = false"
                                            v-if="unit.isEditingPairUpUnit" class="buttonUi">
                                        <span v-if="!unit.isEditingPairUpUnit">
                                            <input type="button" value="ダブル後衛を編集"
                                                @click="unit.isEditingPairUpUnit = true" class="buttonUi">
                                        </span>
                                    </span>
                                    <input type="button" class="buttonUi" style="width:95px"
                                           @click="showSaveUnitDialog()"
                                           value="保存・読み込み">
                                    <input type="button" class="buttonUi" style="width:80px"
                                           @click="g_appData.copyCurrentUnit()"
                                           value="コピー">
                                    <input type="button" class="buttonUi" style="width:80px"
                                           @click="g_appData.pasteToCurrentUnit();" value="ペースト">
                                </div>
                                <unit-detail v-model="unit" v-if="!unit.canHavePairUpUnit || !unit.isEditingPairUpUnit">
                                </unit-detail>
                                <unit-detail v-model="unit.pairUpUnit"
                                    v-show="unit.canHavePairUpUnit && unit.isEditingPairUpUnit"></unit-detail>
                            </li>
                            <li v-for="structure in offenceStructureStorage.objs">
                                <structure-detail v-model="structure">
                                </structure-detail>
                            </li>
                            <li v-for="structure in defenseStructureStorage.objs">
                                <structure-detail v-model="structure">
                                </structure-detail>
                            </li>
                            <!-- </ul>
                    </div>
                    <div>
                        <ul> -->
                            <li v-for="tile in map._tiles">
                                <tile-detail v-model="tile">
                                </tile-detail>
                            </li>
                        </ul>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <debug-settings
                            :is-debug-menu-enabled="isDebugMenuEnabled"
                            :is-development-mode="isDevelopmentMode"
                            @is-debug-changed="debugMenuEnabledChanged"
                            @is-dev-mode-changed="developModeChanged"
                    ></debug-settings>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <log-panel
                            :get-app="getApp"
                            :simulator-log-level="simulatorLogLevel"
                            :skill-log-level="skillLogLevel"
                            :simulator-log-level-option="simulatorLogLevelOption"
                            :save-simulator-log-level="saveSimulatorLogLevel"
                            :skill-log-level-option="skillLogLevelOption"
                            :save-skill-log-level="saveSkillLogLevel"
                            :copy-debug-log-to-clipboard="copyDebugLogToClipboard"
                    ></log-panel>
                    <div v-html="damageCalcLog" id="debugLogPanel"
                         style="height: 400px; border: 1px solid #dddddd;background-color: #ffffff;overflow-y: scroll;">
                    </div>
                </td>
            </tr>
        </table>

        <div id="settingDialog">
            <div style="font-size:12px;text-align: left;">
                <fieldset>
                    <legend>マップ表示の設定</legend>
                    <input id="showMovableRangeWhenMovingUnit" type="checkbox"
                        v-model="showMovableRangeWhenMovingUnit"><label class="normal"
                        for="showMovableRangeWhenMovingUnit">ユニット移動中に移動可能範囲を表示</label>
                    <br />
                    <input id="showAllyAttackRange" type="checkbox"
                        onchange="g_appData.map.switchAllyAttackRange();updateMap();"><label class="normal"
                        for="showAllyAttackRange">味方の攻撃範囲を表示</label>
                    <br />
                    <input id="showClosestDistanceToEnemy" type="checkbox"
                        onchange="g_appData.map.switchClosestDistanceToEnemy();updateMap();"><label class="normal"
                        for="showClosestDistanceToEnemy">最も近い敵への距離を表示</label>
                    <br />
                    <input id="showDivineVeinImage" type="checkbox"
                           v-model="showDivineVeinImageWithoutBreakable"
                           @change="onDivineVeinImageVisibilityChanged">
                    <label class="normal" for="showDivineVeinImage">破壊可能な天脈以外の画像表示</label>
                    <br />
                    <input id="onChangeEnemyIceColor" type="checkbox"
                           v-model="changeEnemyIceColor"
                           @change="onChangeEnemyIceColor">
                    <label class="normal" for="onChangeEnemyIceColor">敵の天脈・氷の色をかえる</label>
                    <br/>
                    マップのマスサイズ: <input type="number" v-model="map.cellWidth" class="numeric" @change="cellSizeChanged" />
                    <br />
                    <input id="isBgImageEnabled" type="checkbox" v-model="map.isBackgroundImageEnabled"
                        @change="backgroundImageEnabledChanged"><label class="normal"
                        for="isBgImageEnabled">マップの背景画像を有効にする</label>
                    <br />
                </fieldset>
                <fieldset>
                    <legend>画像解析の設定</legend>
                    マップ画像解析時の画像サイズ除算値: <input type="number" v-model="imageSizeShrinkDiv" class="numeric" />
                    <br />
                    <input type="checkbox" id="useWhitelistForOcr" v-model="useWhitelistForOcr"><label
                        for="useWhitelistForOcr" class="normal">OCR実行時にホワイトリストを有効化</label>
                    <br />
                </fieldset>
                <fieldset>
                    <legend>その他の設定</legend>
                    <input type="checkbox" id="enableAllSkillOptions" v-model="enableAllSkillOptions"><label
                        for="enableAllSkillOptions" class="normal">スキルの選択肢を継承可能なスキルのみに制限しない</label>
                    <br />
                    <input type="checkbox" id="isCommandUndoable" v-model="isCommandUndoable"><label
                        for="isCommandUndoable" class="normal">「元に戻す」「やり直す」を有効</label>
                    <br />
                    <input type="checkbox" id="isPotentialDamageDetailEnabled"
                        v-model="isPotentialDamageDetailEnabled"><label for="isPotentialDamageDetailEnabled"
                        class="normal">潜在ダメージ計算の詳細ログを表示</label>
                    <br />
                    <input type="checkbox" id="changesBgmRandomly" v-model="changesBgmRandomly"><label
                        for="changesBgmRandomly" class="normal">BGM再生時に曲をランダムで変更する</label>
                    <br />
                    <input type="checkbox" id="changesBgmRandomlyOnLoop"
                        v-model="audioManager.changesBgmRandomlyOnLoop"><label for="changesBgmRandomlyOnLoop"
                        class="normal">BGMループ時に曲をランダムで変更する</label>
                    <br />
                    選択モード:<select v-model="selectMode">
                        <option v-for="option in SelectModeOptions" v-bind:value="option.id">
                            {{ option.text }}
                        </option>
                    </select>

                </fieldset>
            </div>
        </div>
        <div id="mjolnirsStrikeSettingDialog" style="text-align:left;">
            <p>以下を入力すると査定がミョルニルの最大獲得スコアになります。</p>
            将位: <input type="number" v-model="mjolnirsStrikeTier" class="numeric" min="1" max="21" style="width:50px"
                @change="g_app.updateArenaScoreForAllUnits()" />
            <br />
            メジャーシーズン:<select v-model="mjolnirsStrikeMajorSeason" @change="g_app.updateArenaScoreForAllUnits()">
                <option v-for="option in mjolnirsStrikeSeasonOptions" v-bind:value="option.id">
                    {{ option.text }}
                </option>
            </select>
            <br />
            マイナーシーズン:<select v-model="mjolnirsStrikeMinorSeason" @change="g_app.updateArenaScoreForAllUnits()">
                <option v-for="option in mjolnirsStrikeSeasonOptions" v-bind:value="option.id">
                    {{ option.text }}
                </option>
            </select>
            <br />
        </div>
        <div id="ocrSettingDialog" style="text-align: left;">
            <p>
                <label class="normal"><input type="radio" v-model="ocrSettingTarget" value="0">選択中のキャラを設定</label>
                <label class="normal"><input type="radio" v-model="ocrSettingTarget" value="1">敵を一括設定</label>
                <label class="normal"><input type="radio" v-model="ocrSettingTarget" value="2">味方を一括設定</label>
                <label class="normal"><input type="radio" v-model="ocrSettingTarget" value="3">マップを設定</label>
            </p>
            <p>
                <input id="closesDialogAfterStartAnalysis" type="checkbox" checked="checked" />
                <label class="normal" for="closesDialogAfterStartAnalysis">設定開始後にダイアログを閉じる</label><br />
            </p>
            <span v-if="ocrSettingTarget == 3" class="normal">
                <p>
                    <input id="ignoresUnitTileForAutoMapReplace" type="checkbox"
                        v-model="ignoresUnitTileForAutoMapReplace">
                    <label class="normal" for="ignoresUnitTileForAutoMapReplace">ユニットのいるマスに施設を配置しない</label>
                </p>
                <p>
                    防衛マップのキャプチャ画像を選択してください。
                </p>
            </span>
            <p v-if="ocrSettingTarget != 3" class="normal">
                ユニットのステータス画面のキャプチャ画像を選択してください。
            </p>
            <input id="ocrSettingFile" type="file" @change="ocrSettingFileChanged" multiple="multiple"
                accept="image/*" /><br />
            <div v-show="showOcrImage">
                <span class="normal" v-bind:style="debugMenuStyle">
                    切り抜き時のオフセット: <input type="number" v-model="ocrCropX" class="numeric" /><input type="number"
                        v-model="ocrCropY" class="numeric" /></span>
                <p class="normal">キャプチャ画像にゲーム画面以外が含まれている場合、ゲーム画面全体がちょうど収まるように範囲を調整してください。
                    縦横比が16:9に収まらない場合、16:9の比率のまま中央揃えで範囲を調整してください。(16:9に収まらない画面端は無視して下さい)</p>
                <canvas id="tempCanvas" style="display: none;"></canvas>
                <table style="border-style: none;">
                    <tr>
                        <th>元画像</th>
                        <th>調整後(縦横比16:9)</th>
                    </tr>
                    <tr>
                        <td>
                            <canvas id="ocrSettingSourceCanvas" width="1" height="1"></canvas>
                        </td>
                        <td>
                            <canvas id="ocrSettingCroppedCanvas" width="1" height="1"></canvas>
                        </td>
                    </tr>
                </table>
                <span v-bind:style="debugMenuStyle">
                    マッチング手法: <select v-model="templateMatchMethod">
                        <option v-for="option in templateMatchMethodOptions" v-bind:value="option.id">
                            {{ option.text }}
                        </option>
                    </select><br />
                    指定インデックスのテンプレートのみ使用: <input type="number" v-model="debugTemplateIndex" min="-1" class="numeric" />
                    <input type="number" v-model="debugTemplateCount" min="1" class="numeric" /><br />
                    テンプレート:
                    <span v-if="debugTemplateIndex >= 0">
                        {{templateImageFiles[debugTemplateIndex]}}
                    </span>
                    <span v-if="debugTemplateIndex < 0">
                        {{templateImageFiles[currentTemplateIndex]}}
                    </span><br />
                    最大相関値に対する許容相関値の比率: <input type="number" v-model="corrThresholdRate" class="numeric" step="0.01"
                        max="1.0" min="0.0" style="width:100px" /><br />
                    <input type="button" value="解析開始"
                        @click="const files = document.getElementById('ocrSettingFile').files;g_app.setUnitsByStatusImages(files);"><br />
                    <canvas id="croppedImage"></canvas>
                    <canvas v-for="(unit,index) in g_appData.enemyUnits" v-bind:id="'croppedImage'+index" />
                    <canvas id="binarizedImage"></canvas>
                    <canvas v-for="(unit,index) in g_appData.enemyUnits" v-bind:id="'binarizedImage'+index" />
                    <canvas id="templateMatchingOutputImage"></canvas>
                </span>
            </div>
            <!-- <canvas id="jsi-canvas" class="img-canvas" width="1080" height="1920"></canvas> -->
        </div>
        <div id="exportDialog">
            <div style="font-size:12px;text-align: left;">
                <p>
                    以下は現在の設定です。テキストをコピーしてお使いのデバイスに保存してください。<br />
                </p>
                <div style="font-size:12px;text-align: right;">
                    <p>
                    <fieldset>
                        <legend>エクスポート対象</legend>
                        <input id="exportsAllySettings" type="checkbox" v-model="exportsAllySettings"
                            @change="exportSettingChanged" />
                        <label class="normal" for="exportsAllySettings">攻撃編成</label>
                        <input id="exportsOffenceSettings" type="checkbox" v-model="exportsOffenceSettings"
                            @change="exportSettingChanged" />
                        <label class="normal" for="exportsOffenceSettings">攻撃施設</label>
                        <input id="exportsEnemySettings" type="checkbox" v-model="exportsEnemySettings"
                            @change="exportSettingChanged" />
                        <label class="normal" for="exportsEnemySettings">防衛編成</label>
                        <input id="exportsDefenceSettings" type="checkbox" v-model="exportsDefenceSettings"
                            @change="exportSettingChanged" />
                        <label class="normal" for="exportsDefenceSettings">防衛施設</label>
                        <input id="exportsMapSettings" type="checkbox" v-model="exportsMapSettings"
                            @change="exportSettingChanged" />
                        <label class="normal" for="exportsMapSettings">マップ</label>
                    </fieldset>
                    </p>
                    <p>
                    <fieldset>
                        <label class="normal" for="summonerLevel">圧縮形式: </label>
                        <select v-model="settingCompressMode" @change="exportSettingChanged">
                            <option v-for="option in settingCompressModeOptions" v-bind:value="option.id">
                                {{ option.text }}
                            </option>
                        </select>
                        <br />
                        <label class="normal" for="summonerLevel">設定サイズ: </label>{{exportSettingText.length}} byte
                    </fieldset>
                    </p>
                </div>
                <div>
                    <input type="button" value="コピー" class="dialog-button" onclick="copyExportTextToClipboard()">
                    <br />
                    <textarea id="exportText" rows="4" cols="43" readonly="true" v-model="exportSettingText"></textarea>
                </div>
                <div>
                    共有URL:<br />
                    <input type="button" value="コピー" class="dialog-button" onclick="copyExportUrlToClipboard()">
                    <br />
                    <textarea id="exportUrl" rows="4" cols="43" readonly="true" v-model="exportSettingUrl"></textarea>
                </div>
            </div>
        </div>
        <div id="importDialog">
            <div style="font-size:12px;text-align: left;">
                <p>
                    エクスポートしたテキストをここに貼り付けてインポートしてください。<br />
                </p>
                <div style="font-size:12px;text-align: right;">
                    <p>
                    <fieldset>
                        <legend>インポート対象</legend>
                        <input id="loadsAllySettings" type="checkbox" checked="checked" />
                        <label class="normal" for="loadsAllySettings">攻撃編成</label>
                        <input id="loadsOffenceSettings" type="checkbox" checked="checked" />
                        <label class="normal" for="loadsOffenceSettings">攻撃施設</label>
                        <input id="loadsEnemySettings" type="checkbox" checked="checked" />
                        <label class="normal" for="loadsEnemySettings">防衛編成</label>
                        <input id="loadsDefenceSettings" type="checkbox" checked="checked" />
                        <label class="normal" for="loadsDefenceSettings">防衛施設</label>
                        <input id="loadsMapSettings" type="checkbox" checked="checked" />
                        <label class="normal" for="loadsMapSettings">マップ</label>
                    </fieldset>
                    <fieldset>
                        <!-- <label class="normal" for="summonerLevel">圧縮形式: </label>
                            <select2 :options="settingCompressModeOptions" v-model="settingCompressMode">
                            </select2> -->
                        <!-- <br /> -->
                        <input id="closesDialogAfterImport" type="checkbox" checked="checked" />
                        <label class="normal" for="closesDialogAfterImport">インポート後にダイアログを閉じる</label>
                    </fieldset>
                    </p>
                </div>
                <div>
                    <!-- <input type="button" value='貼り付け' class='dialog-button'
                        onclick="pasteClipboardToImportText()"> -->
                    <input type="button" value="クリア" class="dialog-button" onclick="clearImportText()">
                    <input type="button" value="インポート" class="dialog-button" onclick="importText()">
                    <br />
                    <textarea id="importText" rows="4" cols="43" placeholder="ここに設定を入力してください"></textarea>
                </div>
            </div>
        </div>
        <div id="durabilityTestDialog" style="text-align: left;">
            <p style="font-size:12px">
                テスト対象とリリース済みの全英雄との戦闘結果からテスト対象の耐久力や殲滅力を評価します。
                敵の凸数などは選択した敵ユニットのものを採用します。スキルは初期スキル、武器錬成は特殊錬成で評価します。初期スキルに奥義がない場合はデフォルト奥義を装備します。
            </p>
            <p>
                <label for="durabilityTestIsAllyUnitOffence">先制攻撃で評価(殲滅力を評価)</label>
                <input id="durabilityTestIsAllyUnitOffence" type="checkbox" v-model="durabilityTestIsAllyUnitOffence">
            </p>
            <p>
                <label>テスト対象</label>
                <select v-model="durabilityTestAllyUnitId">
                    <option v-for="unit in allyUnits" v-bind:value="unit.id">
                        {{ unit.getNameWithGroup() }}
                    </option>
                </select>
                <br />
                <label>敵ユニット</label>
                <select v-model="durabilityTestEnemyUnitId">
                    <option v-for="unit in enemyUnits" v-bind:value="unit.id">
                        {{ unit.getNameWithGroup() }}
                    </option>
                </select>
            <details>
                <summary>詳細設定</summary>
                <label for="durabilityTestHealsHpFull">フルHPで評価</label>
                <input id="durabilityTestHealsHpFull" type="checkbox" v-model="durabilityTestHealsHpFull" />
                <br />
                <label for="durabilityTestBattleCount">連戦回数</label>
                <input id="durabilityTestBattleCount" min="1" max="10" type="number"
                    v-model="durabilityTestBattleCount" />
                <br />
                <label>デフォルト奥義</label>
                <select2 :options="specialOptions" v-model="durabilityTestDefaultSpecial" class="skill">
                </select2>
                <br />
                <label for="durabilityTestChargesSpecialCount">敵を奥義発動可能状態で評価</label>
                <input id="durabilityTestChargesSpecialCount" type="checkbox"
                    v-model="durabilityTestChargesSpecialCount" />
                <br />
                <label for="durabilityTestCalcPotentialDamage">潜在ダメージで評価</label>
                <input id="durabilityTestCalcPotentialDamage" type="checkbox"
                    v-model="durabilityTestCalcPotentialDamage" />
                <br />
                <label for="durabilityTestEquipAllDistCounter">全距離反撃できなければ遠反/近反を装備</label>
                <input id="durabilityTestEquipAllDistCounter" type="checkbox"
                    v-model="durabilityTestEquipAllDistCounter" />
                <br />
                <label for="durabilityTestAppliesSkillsForBeginningOfTurn">ターン開始時のスキルを適用</label>
                <input id="durabilityTestAppliesSkillsForBeginningOfTurn" type="checkbox"
                    v-model="durabilityTestAppliesSkillsForBeginningOfTurn" />
                <br />

                <label for="durabilityTestIsLogEnabled">デバッグログ出力</label>
                <input id="durabilityTestIsLogEnabled" type="checkbox" v-model="durabilityTestIsLogEnabled" />
                <br />
                <label for="durabilityTestLogDamageCalcDetailIfLose">敗北時の戦闘ログをデバッグログに出力</label>
                <input id="durabilityTestLogDamageCalcDetailIfLose" type="checkbox"
                    v-model="durabilityTestLogDamageCalcDetailIfLose" />
            </details>
            </p>
            <p>
                <input type="button" value="1vs1の配置に設定" @click="g_app.setOneVsOneForDurabilityTest();">
                <input type="button" value="テスト開始" @click="g_app.beginDurabilityTest();">
                <input type="button" value="ランキング作成" @click="g_app.createDurabilityRanking();">
                <input type="button" value="殲滅力ダメージプロット" @click="g_app.plotDamage()">
            </p>
            <div v-html="durabilityTestLog"
                style="min-height: 50px; padding: 10px; border: 1px solid #ddd;background-color: #fff;">
            </div>
        </div>
        <div id="aetherRaidDefensePresetDialog">
            <p>模擬戦する防衛を選択してください。</p>
            <fieldset>
                <legend>防衛マッププリセット</legend>
                <p>
                <div v-if="globalBattleContext.isLightSeason == true">
                    <select v-model="aetherRaidDefensePreset" @change="aetherRaidDefensePresetChanged">
                        <option v-for="option in AetherRaidDefensePresetOptions_DarkSeason" v-bind:value="option.id">
                            {{ option.text }}
                        </option>
                    </select>
                </div>
                <div v-else>
                    <select v-model="aetherRaidDefensePreset" @change="aetherRaidDefensePresetChanged">
                        <option v-for="option in AetherRaidDefensePresetOptions_AnimaSeason" v-bind:value="option.id">
                            {{ option.text }}
                        </option>
                    </select>
                </div>
                </p>
                <p v-html="aetherRaidDefensePresetDescription">
                </p>
                <p>
                    <input type="button" value="選択した防衛マップに設定" @click="g_app.setCurrentAetherRaidDefensePreset();">
                </p>
            </fieldset>
            <fieldset>
                <legend>攻撃編成プリセット</legend>
                <p>
                <div v-if="globalBattleContext.isLightSeason == true">
                    <select v-model="aetherRaidOffensePresetIndex" @change="aetherRaidOffensePresetChanged">
                        <option v-for="(option,index) in AetherRaidOffensePresetOptions_LightSeason"
                            v-bind:value="index">
                            {{ option.text }}
                        </option>
                    </select>
                </div>
                <div v-else>
                    <select v-model="aetherRaidOffensePresetIndex" @change="aetherRaidOffensePresetChanged">
                        <option v-for="(option,index) in AetherRaidOffensePresetOptions_AstraSeason"
                            v-bind:value="index">
                            {{ option.text }}
                        </option>
                    </select>
                </div>
                </p>
                <p>
                    <input type="button" value="選択した攻撃編成に設定" @click="g_app.setCurrentAetherRaidOffensePreset();">
                </p>
            </fieldset>
        </div>
        <div id="itemDialog">
            <p>使用するアイテムを選択してください。</p>
            <span v-for="item in resonantBattleItems">
                <input type="button" v-bind:value="getItemTypeName(item)" @click="g_app.useItem(item);"
                    class="itemDialog-button"><br />
            </span>

            <!-- <input v-if="g_appData.hasItem(ItemType.RakuraiNoJufu)" type="button" value="落雷の呪符"
                @click="g_app.useItem(ItemType.RakuraiNoJufu);$('#itemDialog').dialog('close');"
                class="itemDialog-button"><br />
            <input v-if="g_appData.hasItem(ItemType.KobuNoTsunobue)" type="button" value="鼓舞の角笛"
                @click="g_app.useItem(ItemType.KobuNoTsunobue);$('#itemDialog').dialog('close');"
                class="itemDialog-button"><br />
            <input v-if="g_appData.hasItem(ItemType.KogunNoBoots)" type="button" value="行軍のブーツ"
                @click="g_app.useItem(ItemType.KogunNoBoots);$('#itemDialog').dialog('close');"
                class="itemDialog-button"><br />
            <input v-if="g_appData.hasItem(ItemType.OugiNoYaiba)" type="button" value="奥義の刃"
                @click="g_app.useItem(ItemType.OugiNoYaiba);$('#itemDialog').dialog('close');"
                class="itemDialog-button"><br />
            <input v-if="g_appData.hasItem(ItemType.Tokkoyaku)" type="button" value="特効薬"
                @click="g_app.useItem(ItemType.Tokkoyaku);$('#itemDialog').dialog('close');"
                class="itemDialog-button"><br />
            <input v-if="g_appData.hasItem(ItemType.OdorikoNoVeru)" type="button" value="踊り子のヴェール"
                @click="g_app.useItem(ItemType.OdorikoNoVeru);$('#itemDialog').dialog('close');"
                class="itemDialog-button"> -->
        </div>
        <div id="editMapDialog" style="text-align:left;">
            <div style="font-size: 10px;">
                <table>
                    <tr>
                        <td>壁:</td>
                        <td>{{map.countWallsOnMap()}}
                            <input type="button" value="＋" @click="addWallToMap">
                            <input type="button" value="－" @click="removeWallFromMap">
                        </td>
                    </tr>
                    <tr>
                        <td>壊せる壁:</td>
                        <td>{{map.countBreakableWallsOnMap()}}
                            <input type="button" value="＋" @click="addBreakableWallToMap">
                            <input type="button" value="－" @click="removeBreakableWallFromMap">
                        </td>
                    </tr>
                </table>
            </div>
            <div style="margin:5;">
                <input type="button" value="スクリプト更新" @click="map.updateSourceCode()" style="font-size: 8px;">
                <input type="button" @click="copyMapSourceCodeToClipboard();" value="コピー" style="font-size: 8px;" />
                <br />
                <textarea id="mapSourceCode" style="font-size: 8px;" rows="10" cols="43" readonly="true"
                    v-model="map.sourceCode"></textarea>
            </div>
        </div>
        <div id="setupResonantBattleEnemyDialog" style="text-align: left;">
            <div v-if="g_appData.currentUnit != null">
                {{g_appData.currentUnit.getNameWithGroup()}}のスキル設定が完了したら、ゲーム中のステータスを入力して「適用」ボタンを押してください。
                <table>
                    <tr>
                        <th>HP</th>
                        <td>
                            <input min="0" max="99" type="number" v-model="rbEnemySettingInputHp">
                        </td>
                    </tr>
                    <tr>
                        <th>攻</th>
                        <td>
                            <input min="0" max="99" type="number" v-model="rbEnemySettingInputAtk">
                        </td>
                    </tr>
                    <tr>
                        <th>速</th>
                        <td>
                            <input min="0" max="99" type="number" v-model="rbEnemySettingInputSpd">
                        </td>
                    </tr>
                    <tr>
                        <th>守</th>
                        <td>
                            <input min="0" max="99" type="number" v-model="rbEnemySettingInputDef">
                        </td>
                    </tr>
                    <tr>
                        <th>魔</th>
                        <td>
                            <input min="0" max="99" type="number" v-model="rbEnemySettingInputRes">
                        </td>
                    </tr>
                </table>
            </div>
            <div style="text-align: right;">
                <input type="button" value="適用" class="dialog-button" @click="g_app.applyResonantBattleEnemyStatus()">
            </div>
        </div>
        <div id="autoClearDialog" style="text-align:left;">
            <p style="font-size: 10pt;">このツールは開発中で正しく動かないので使わないでください。</p>
            <p>
                <label class="normal" for="limitsExamineRangeToMovableRange">調査範囲を移動可能範囲に制限</label>
                <input id="limitsExamineRangeToMovableRange" type="checkbox"
                    v-model="limitsExamineRangeToMovableRange" />
                <br />
                <label class="normal" for="limitsExamineRangeToThreatenedRange">調査範囲を敵の攻撃範囲に制限</label>
                <input id="limitsExamineRangeToThreatenedRange" type="checkbox"
                    v-model="limitsExamineRangeToThreatenedRange" />
                <br />
                <label class="normal" for="limitsExamineRangeToNoTrapTiles">調査範囲を罠のないマスに制限</label>
                <input id="limitsExamineRangeToNoTrapTiles" type="checkbox" v-model="limitsExamineRangeToNoTrapTiles" />
            </p>
            <input type="button" value="ランダム行動" class="buttonUi" style="width: 250"
                @click="g_app.clearLog(); g_app.origAi.executeRandomAction();"><br />
            <input type="button" value="おまかせ" class="buttonUi" style="width: 250"
                @click="g_app.clearLog(); g_app.simulateAllyActionCustomized();"><br />
            <input type="button" value="おまかせ2" class="buttonUi" style="width: 250"
                @click="g_app.origAi.__origAi_simulate2();"><br />
            <input type="button" value="おまかせ3" class="buttonUi" style="width: 250"
                @click="g_app.origAi.__origAi_simulate3();"><br />
            <input type="button" value="生存するマスを調査" class="buttonUi" style="width: 250"
                @click="examinesAliveTiles"><br />
            <input type="button" value="マスの情報表示をリセット" class="buttonUi" style="width: 250" @click="resetCellOverrides">
            <input type="button" value="破壊可能な防衛施設除外" class="buttonUi" style="width: 250"
                @click="removeDefenceStructuresNoEffectForEnemyMovement">
            <input type="button" value="攻めブレムおまかせ" class="buttonUi" style="width: 250"
                @click="examinesAttackableEnemies">
            <br />
        </div>
        <div id="saveUnitDialog" class="unit-dialog">
            <unit-storage-dialog
                    :get-app-data="getAppData"
                    :saved-units="savedUnits"
                    :weapon-type-icon-path="weaponTypeIconPath"
                    :move-type-icon-path="moveTypeIconPath"
                    :show-flash="showFlash"
            >
            </unit-storage-dialog>
        </div>
        <div v-bind:style="debugMenuStyle">
            <textarea style="height: 150px;width:300px;" v-bind:value="ocrResult"></textarea><br />
            <!-- <canvas id="trimmedImage" style="width:1080;height:1920" class="img-canvas"></canvas> -->

            <canvas id="ocrInputImage0"></canvas>
            <canvas id="ocrInputImage1"></canvas>
            <canvas id="ocrInputImage2"></canvas>
            <canvas id="ocrInputImage3"></canvas>
            <canvas id="ocrInputImage11"></canvas>
            <canvas id="ocrInputImage4"></canvas>
            <canvas id="ocrInputImage5"></canvas>
            <canvas id="ocrInputImage6"></canvas>
            <canvas id="ocrInputImage7"></canvas>
            <canvas id="ocrInputImage8"></canvas>
            <canvas id="ocrInputImage9"></canvas>
            <canvas id="ocrInputImage10"></canvas>
            <canvas id="ocrInputImage12"></canvas>

            <canvas id="ocrInputImageForWeaponIcon"></canvas>
            <canvas id="ocrInputImageForEngageIcon"></canvas>

            <span v-for="imgFile in templateWeaponRefinementImageFiles">
                <img src="/images/dummy.png" v-bind:data-src="g_corsImageRootPath + 'Templates/' + imgFile.fileName"
                    v-bind:id="imgFile.fileName" class="lazyTemplateImage" v-bind:alt="imgFile.fileName" />
            </span>
            <span v-for="imgFile in templateBlessingImageFiles">
                <img src="/images/dummy.png" v-bind:data-src="g_corsImageRootPath + 'Templates/' + imgFile.fileName"
                    v-bind:id="imgFile.fileName" class="lazyTemplateImage" v-bind:alt="imgFile.fileName" />
            </span>
            <span v-for="imgFile in templateImageFiles">
                <img src="/images/dummy.png" v-bind:data-src="g_corsImageRootPath + 'Templates/' + imgFile"
                    class="lazyTemplateImage" v-bind:id="imgFile" v-bind:alt="imgFile" />
            </span>
            <span v-for="imgFile in mapImageFiles">
                <img src="/images/dummy.png" v-bind:data-src="g_corsImageRootPath + 'Maps/' + imgFile.fileName"
                    class="lazyTemplateImageForAetherRaid" v-bind:id="imgFile.fileName" v-bind:alt="imgFile.fileName" />
            </span>
            <span v-for="imgFile in arenaMapImageFiles">
                <img src="/images/dummy.png" v-bind:data-src="g_corsImageRootPath + 'Maps/' + imgFile.fileName"
                    class="lazyTemplateImageForArena" v-bind:id="imgFile.fileName" v-bind:alt="imgFile.fileName" />
            </span>
            <span v-for="imgFile in templateEngageSpecialIconFiles">
                <img src="/images/dummy.png" v-bind:data-src="`${g_corsImageRootPath}images/FehSkillIcons/EngagedSpecial/${imgFile.fileName}`"
                     v-bind:id="imgFile.fileName" class="lazyTemplateImage" v-bind:alt="imgFile.fileName"/>
            </span>
        </div>
    </div>
    <style>
        .select2-results__options {
            font-size: 12px;
        }

        .select2-selection__rendered {
            font-size: 12px;
        }
    </style>
    <script type="text/x-template" id="tile-detail-template">
        <div>
            座標: ({{value.posX}}, {{value.posY}})
            <br/>
            種類: <select v-model="value._type" @change="g_app.tileTypeChanged()">
                <option v-for="option in TileTypeOptions" v-bind:value="option.id">
                    {{ option.text }}
                </option>
            </select>
            <br/>
            敵群の危険度: {{value.getEnemyThreatFor(UnitGroupType.Enemy)}}
            <br/>
            自軍の危険度: {{value.getEnemyThreatFor(UnitGroupType.Ally)}}
            <div v-if="value.hasDivineVein()">
                {{value.divineVeinGroup === UnitGroupType.Ally ? "自軍" : "敵軍"}}
                <a v-bind:href="getDivineVeinPath(value.divineVein)" target="_blank">
                    <img v-bind:src="getDivineVeinImgPath(value.divineVein)"
                         v-bind:title="getDivineVeinTitle(value.divineVein)"
                         v-bind:alt="DIVINE_VEIN_STRINGS[value.divineVein]"
                         class="tile-info-icon">
                </a>
            </div>
        </div>
    </script>
    <script type="text/x-template" id="structure-detail-template">
        <div style="height:500px;vertical-align:middle;display: table-cell;padding:10px">
            <div  style="margin:5px">
            {{value.name}}<span v-bind:style="g_app.vm.debugMenuStyle">({{value.id}})</span>
            </div>
            <div v-if="value instanceof Ornament" style="margin:5px">
                <select v-model="value.ornamentTypeIndex" @change="g_app.vm.ornamentIconChanged" style="width:150px">
                    <option v-for="option in g_appData.ornamentTypeOptions" v-bind:value="option.id">
                        {{ option.text }}
                    </option>
                </select>
            </div>
            <div v-if="value.hasLevel" style="margin:5px">
                <label class="normal" for="level">LV.</label>
                <input name="level" type="number" max="10" min="1"
                    v-model="value.level" class="statusInput" @input="g_app.vm.structureLevelChanged" />            
            </div>
            <div>
                <span class="normal" >{{value.description}}</span>
            </div>                
            <div v-if="value.isExecutable" style="margin:5px">
                <input v-bind:style="g_app.vm.debugMenuStyle" type="button" value='効果を発動' class="buttonUi"
                    @click="g_app.executeCurrentStructure()" style="width:150px;">
            </div>
            <label>
                <input v-model="value.isDisabled" type="checkbox" @change="updateAllUi"/>
                発動済み
            </label>
        </div>
    </script>
    <script type="text/x-template" id="status-label-template">
        {{statusType}}
        <span v-if="unit.isAsset(statusType)" class="assetStatus">
        {{statusTypeToShortString(statusType)}}
        </span>
        <span v-else-if="unit.isFlaw(statusType)" class="flowStatus">
        {{statusTypeToShortString(statusType)}}
        </span>                                        
        <span v-else class="normalStatus">
        {{statusTypeToShortString(statusType)}}
        </span>
    </script>
    <script type="text/x-template" id="unit-detail-template">
        <table border='0' style='border-width: 0px;border-style:none;' v-if="value != null">
            <tr>
                <td>
                    <table border='0' style='border-width: 0px;border-style:none;'>
                        <tr>
                            <td>
                                <select2 :options="g_app.vm.heroOptions" v-model="value.heroIndex" class="hero"
                                    @input="g_app.vm.heroIndexChanged">
                                </select2>
                                <a v-bind:href="value.detailPageUrl" target="_blank" v-if="value.heroIndex >= 0">
                                    <img class="urlJumpIcon" v-bind:src="g_imageRootPath + 'UrlJump.png'" /></a>
                                <span class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >({{value.heroIndex}})</span>
                                <br/>
                                ★
                                <select v-model="value.rarity" @change="g_app.vm.ivChanged">
                                    <option v-for="item in UnitRarity" v-bind:value="item">
                                        {{ item}}
                                    </option>
                                </select>
                                <label class="normal" for="merge">LV.</label>
                                <input name="level" type="number" v-model="value.level"
                                    min="1" max="99" class="numeric" @input="g_app.vm.mergeChanged" />
                                +<input name="merge" type="number" v-model="value.merge"
                                    min="0" max="10" class="numeric" @input="g_app.vm.mergeChanged" />
                                <label class="normal" for="dragonflower">花+</label>
                                <input name="dragonflower" type="number"
                                    v-model="value.dragonflower" min="0" v-bind:max="value.maxDragonflower"
                                    class="numeric" @input="g_app.vm.dragonflowerChanged" />
                                <label class="normal" for="reinforcementMerge">増+</label>
                                <input name="reinforcementMerge" type="number"
                                       v-model="value.reinforcementMerge" min="0" v-bind:max="10"
                                       class="numeric" disabled/>
                            </td>
                        </tr>
                        <tr  v-bind:style="g_app.vm.debugMenuStyle">
                            <td>
                                id={{value.id}} 
                                <label  class="normal" for="slotOrder">スロット番号: </label>
                                <input   name="slotOrder" type="number" min="0" max="5" readonly="readonly"
                                    v-model="value.slotOrder" class="statusInput"
                                    @input="g_app.vm.slotOrderChanged" />
                                <span class="debugInfo">
                                    <label class="normal" for="moveCount">移動値: </label>
                                    <input name="moveCount" type="number" readonly="readonly"
                                        v-model="value.moveCount" class="statusInput"
                                        @input="g_app.vm.moveCountChanged" />({{value.moveCountAtBeginningOfTurn}})
                                </span>
                                <label class="debugInfo" class="normal" for="moveCountAtBeginningOfTurn">ターン開始時の移動値: </label>
                                <input class="debugInfo" name="moveCountAtBeginningOfTurn" type="number" readonly="readonly"
                                    v-model="value.moveCountAtBeginningOfTurn" class="statusInput"
                                   />
                                <span v-if="value.heroInfo != null">
                                <label  class="normal" for="origin">出典: </label>{{ value.heroInfo.origin }}
                                </span>
                                <span v-if="value.heroInfo != null">
                                <label  class="normal" for="origin">バージョン: </label>{{ value.heroInfo.bookVersion }}
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <span>
                                    <label class="normal" >召喚士との絆: </label>
                                    <select v-model="value.summonerLevel" @change="g_app.vm.summonerLevelChanged">
                                        <option v-for="option in g_appData.summonerLevelOptions" v-bind:value="option.id">
                                            {{ option.text }}
                                        </option>
                                    </select>
                                </span>
                                <span v-if="value.providableBlessingSeason == SeasonType.None">
                                    <label class="normal" for="grantedBlessing">祝福: </label>
                                    <select v-model="value.grantedBlessing" @change="g_app.vm.grantedBlessingChanged">
                                        <option v-for="option in g_appData.seasonOptions" v-bind:value="option.id">
                                            {{ option.text }}
                                        </option>
                                    </select>
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label class="normal" for="ivHigh">得意: </label>
                                <select v-model="value.ivHighStat" @change="g_app.vm.ivChanged">
                                    <option v-for="option in IvStateOptions" v-bind:value="option.id">
                                        {{ option.text }}
                                    </option>
                                </select>
                                <label class="normal" for="ivLow">苦手: </label>
                                <select v-model="value.ivLowStat" @change="g_app.vm.ivChanged">
                                    <option v-for="option in IvStateOptions" v-bind:value="option.id">
                                        {{ option.text }}
                                    </option>
                                </select>
                                <label class="normal"><img
                                        :src="g_imageRootPath + 'AscendedFloret.png'" width="20"
                                        height="20"></label>
                                <select v-model="value.ascendedAsset" @change="g_app.vm.ivChanged">
                                    <option v-for="option in IvStateOptions" v-bind:value="option.id">
                                        {{ option.text }}
                                    </option>
                                </select>
                                <input v-bind:id='"isBonusChar"+value.id' type="checkbox" v-model="value.isBonusChar" @change="g_app.vm.isBonusCharChanged" />
                                <label class="normal" v-bind:for='"isBonusChar"+value.id'>ボナ補正</label>
                                <input v-bind:id='"isAidesEssenceUsed"+value.id' type="checkbox" v-model="value.isAidesEssenceUsed" @change="g_app.vm.isAidesEssenceUsedChanged" />
                                <label class="normal" v-bind:for='"isAidesEssenceUsed"+value.id'>お供</label>
                                <span v-if="value.heroInfo!=null && value.heroInfo.isResplendent">
                                <input v-bind:id='"isResplendent"+value.id' type="checkbox" v-model="value.isResplendent" @change="g_app.vm.isBonusCharChanged" />
                                <label class="normal" v-bind:for='"isResplendent"+value.id'>神装</label>
                                </span>
                                <br />
                                <span>
                                    <label class="normal">支援: </label>
                                    <select2 :options="g_app.vm.heroOptions" v-model="value.partnerHeroIndex"
                                             class="hero"
                                             @input="g_app.updateAllUnitSpur();g_app.updatePartner(value)">
                                    </select2>
                                    <span class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle">
                                        <a href="{{value.detailPageUrl}}">({{value.partnerHeroIndex}})</a>
                                    </span>

                                    <label class="normal">レベル</label>
                                    <select v-model="value.partnerLevel"
                                            @change="g_app.updateAllUnitSpur();g_app.updatePartner(value)">
                                        <option v-for="option in g_appData.partnerLevelOptions"
                                                v-bind:value="option.id">
                                            {{ option.text }}
                                        </option>
                                    </select>
                                    <br/>
                                </span>

                                <label class="normal">紋章士: </label>
                                <select2 :options="g_app.vm.emblemHeroOptions" v-model="value.emblemHeroIndex"
                                         class="hero"
                                         @input="value.resetMaxSpecialCount();g_app.updateAllUnitSpur();g_app.vm.emblemHeroMergeChanged(true)">
                                </select2>
                                <span class="debugInfo" v-bind:style="g_app.vm.debugMenuStyle" >({{value.emblemHeroIndex}})</span>

                                <label class="normal">＋: </label>
                                <input name="emblemHeroMerge" type="number"
                                       v-model="value.emblemHeroMerge" min="0" v-bind:max="10"
                                       class="numeric" @input="g_app.vm.emblemHeroMergeChanged" />
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <table border='0' style='border-width: 0px;border-style:none;'>
                        <tr>
                            <td colspan="7">
                                <label class="normal" for="currentUnitHp">HP: </label>
                                <input name="currentUnitHp" type="number" min="0" @input="g_app.vm.hpChanged"
                                    v-bind:max="value.maxHpWithSkills"
                                    v-model="value.hp" class="numeric" />/
                                <!-- <input type="number" v-model="value.maxHpWithSkills"
                                    min="1" class="numeric" /> -->
                                {{value.maxHpWithSkills}}
                                <span
                                    style="font-size:11px">({{value.hpPercentage}}%)</span>

                                <input type="button" value='全回復' class="buttonUi"
                                    @click="g_app.vm.healHpFull" v-bind:style="g_app.vm.debugMenuStyle">
                                <input type="button" value='ステータス初期化' class="buttonUi"
                                    @click="g_app.__updateStatusBySkillsAndMerges(value);" v-bind:style="g_app.vm.debugMenuStyle">
                                <input v-if="g_appData.gameMode == GameMode.ResonantBattles" type="button" value="双界の敵ステータス設定..." style="width:140px" class="buttonUi" @click="$('#setupResonantBattleEnemyDialog').dialog('open');">
                            </td>
                        </tr>
                        <tr>
                            <th class='param'>
                            </th>
                            <th class='param'>
                                
                            </th>
                            <th class='param'>
                                強化
                            </th>
                            <th class='param'>
                                弱化
                            </th>
                            <th class='param'>
                                戦闘中
                            </th>
                            <th class='param' v-if="g_appData.gameMode == GameMode.ResonantBattles||g_appData.gameMode == GameMode.TempestTrials" >
                                乗算
                            </th>
                            <th class='param' >
                                加算
                            </th>
                            <th class='param'>
                                合計
                            </th>
                            <th class='param' v-bind:style="g_app.vm.debugMenuStyle">成長率</th>
                        </tr>
                        <tr>
                            <th class='param'>
                                <status-label v-bind:statusType="StatusType.Hp" v-bind:unit="value" ></status-label>
                            </th>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.atkWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.maxHpWithSkillsWithoutAdd}}
                            </td>
                            <td class='param'>
                            </td>
                            <td class='param'>
                            </td>
                            <td class='param'>
                            </td>
                            <td class='param' v-if="g_appData.gameMode == GameMode.ResonantBattles||g_appData.gameMode == GameMode.TempestTrials">
                                <input class='numericFloat' v-model="value.hpMult" type="number" min="0" max="2" step="0.01">
                            </td>
                            <td class='param' ><input class='numeric'
                                    v-model="value.hpAdd" type="number" min="-99"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                {{value.maxHpWithSkills}}
                            </td>
                            <td class='param' v-bind:style="g_app.vm.debugMenuStyle">
                                <input class='numericFloat' v-model="value.hpGrowthRate" @change="g_app.__updateStatusBySkillsAndMerges(value, false)" type="number" min="0" max="2" step="0.05">
                            </td>
                        </tr>
                        <tr>
                            <th class='param'>
                                <status-label v-bind:statusType="StatusType.Atk" v-bind:unit="value" ></status-label>
                            </th>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.atkWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.atkWithSkills - value.atkAdd}} + {{ value.getGreatTalent(STATUS_INDEX.Atk) }}
                            </td>
                            <td class='param'>
                                <input class='numeric' v-model=" value.atkBuff" @change="g_app.vm.buffChanged"
                                    type="number" min="-99" max="99" step="1">
                            </td>
                            <td class='param'><input class='numeric'
                                    v-model="value.atkDebuff" type="number" min="-99" @change="g_app.vm.buffChanged"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.atkSpur"
                                    type="number" min="0" max="99" step="1" readonly="readonly"> -->
                                {{value.atkSpur}}
                            </td>
                            <td class='param' v-if="g_appData.gameMode == GameMode.ResonantBattles||g_appData.gameMode == GameMode.TempestTrials">
                                <input class='numericFloat' v-model="value.atkMult" @change="g_app.vm.addChanged" type="number" min="0" max="2" step="0.01">
                            </td>
                            <td class='param' ><input class='numeric'
                                    v-model="value.atkAdd" type="number" min="-99" @change="g_app.vm.addChanged"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                {{value.getAtkInCombat()}}({{value.getAtkInPrecombat()}})
                            </td>
                            <td class='param' v-bind:style="g_app.vm.debugMenuStyle">
                                <input class='numericFloat' v-model="value.atkGrowthRate" @change="g_app.__updateStatusBySkillsAndMerges(value, false)" type="number" min="0" max="2" step="0.05">
                            </td>
                        </tr>
                        <tr>
                            <th class='param'>
                                <status-label v-bind:statusType="StatusType.Spd" v-bind:unit="value" ></status-label>
                            </th>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.spdWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.spdWithSkills-value.spdAdd}} + {{ value.getGreatTalent(STATUS_INDEX.Spd) }}
                            </td>
                            <td class='param'>
                                <input class='numeric' v-model="value.spdBuff" @change="g_app.vm.buffChanged"
                                    type="number" min="-99" max="99" step="1">
                            </td>
                            <td class='param'><input class='numeric' @change="g_app.vm.buffChanged"
                                    v-model="value.spdDebuff" type="number" min="-99"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.spdSpur"
                                    type="number" min="0" max="99" step="1" readonly="readonly"> -->
                                {{value.spdSpur}}
                            </td>
                            <td class='param' v-if="g_appData.gameMode == GameMode.ResonantBattles||g_appData.gameMode == GameMode.TempestTrials" >
                                <input class='numericFloat' v-model="value.spdMult" @change="g_app.vm.addChanged" type="number" min="0" max="2" step="0.01">
                            </td>
                            <td class='param'><input class='numeric'
                                    v-model="value.spdAdd" type="number" min="-99" @change="g_app.vm.addChanged"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                {{value.getSpdInCombat()}}({{value.getSpdInPrecombat()}})
                            </td>
                            <td class='param' v-bind:style="g_app.vm.debugMenuStyle">
                                <input class='numericFloat' v-model="value.spdGrowthRate" @change="g_app.__updateStatusBySkillsAndMerges(value, false)" type="number" min="0" max="2" step="0.05">
                            </td>
                        </tr>
                        <tr>
                            <th class='param'>
                                <status-label v-bind:statusType="StatusType.Def" v-bind:unit="value" ></status-label>
                            </th>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.defWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.defWithSkills - value.defAdd}} + {{ value.getGreatTalent(STATUS_INDEX.Def) }}
                            </td>
                            <td class='param'>
                                <input class='numeric' v-model="value.defBuff" @change="g_app.vm.buffChanged"
                                    type="number" min="-99" max="99" step="1">
                            </td>
                            <td class='param'><input class='numeric' @change="g_app.vm.buffChanged"
                                    v-model="value.defDebuff" type="number" min="-99"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.defSpur"
                                    type="number" min="0" max="99" step="1" readonly="readonly"> -->
                                {{value.defSpur}}
                            </td>
                            <td class='param' v-if="g_appData.gameMode == GameMode.ResonantBattles||g_appData.gameMode == GameMode.TempestTrials">
                                <input class='numericFloat' v-model="value.defMult" @change="g_app.vm.addChanged" type="number" min="0" max="2" step="0.01">
                            </td>
                            <td class='param'><input class='numeric'
                                    v-model="value.defAdd" type="number" min="-99" @change="g_app.vm.addChanged"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                {{value.getDefInCombat()}}({{value.getDefInPrecombat()}})
                            </td>
                            <td class='param' v-bind:style="g_app.vm.debugMenuStyle">
                                <input class='numericFloat' v-model="value.defGrowthRate" @change="g_app.__updateStatusBySkillsAndMerges(value, false)" type="number" min="0" max="2" step="0.05">
                            </td>

                        </tr>
                        <tr>
                            <th class='param'>
                                <status-label v-bind:statusType="StatusType.Res" v-bind:unit="value" ></status-label>
                            </th>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.resWithSkills"
                                    type="number" min="1" max="99" step="1" readonly="readonly"> -->
                                {{value.resWithSkills - value.resAdd}} + {{ value.getGreatTalent(STATUS_INDEX.Res) }}
                            </td>
                            <td class='param'>
                                <input class='numeric' v-model="value.resBuff" @change="g_app.vm.buffChanged"
                                    type="number" min="-99" max="99" step="1">
                            </td>
                            <td class='param'><input class='numeric' @change="g_app.vm.buffChanged"
                                    v-model="value.resDebuff" type="number" min="-99"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                <!-- <input class='numeric' v-model="value.resSpur"
                                    type="number" min="0" max="99" step="1" readonly="readonly"> -->
                                {{value.resSpur}}
                            </td>
                            <td class='param' v-if="g_appData.gameMode == GameMode.ResonantBattles||g_appData.gameMode == GameMode.TempestTrials" >
                                <input class='numericFloat' v-model="value.resMult" @change="g_app.vm.addChanged" type="number" min="0" max="2" step="0.01">
                            </td>
                            <td class='param'><input class='numeric'
                                    v-model="value.resAdd" type="number" min="-99" @change="g_app.vm.addChanged"
                                    max="99" step="1">
                            </td>
                            <td class='param'>
                                {{value.getResInCombat()}}({{value.getResInPrecombat()}})
                            </td>
                            <td class='param' v-bind:style="g_app.vm.debugMenuStyle">
                                <input class='numericFloat' v-model="value.resGrowthRate" @change="g_app.__updateStatusBySkillsAndMerges(value, false)" type="number" min="0" max="2" step="0.05">
                            </td>
                        </tr>
                        <tr>
                            <td>
                            </td>
                            <td class='param'>
                                {{value.atkWithSkills+value.atkBuff+value.atkDebuff
                                    +value.spdWithSkills+value.spdBuff+value.spdDebuff
                                    +value.defWithSkills+value.defBuff+value.defDebuff
                                    +value.resWithSkills+value.resBuff+value.resDebuff}}
                            </td>
                            <td colspan="3">
                            </td>
                            <td v-if="g_appData.gameMode == GameMode.ResonantBattles||g_appData.gameMode == GameMode.TempestTrials">
                                <input type="button" value='リセット' class="buttonUi" style="font-size:10px"
                                       @click="value.resetStatusMult();g_appData.__updateStatusBySkillsAndMergeForAllHeroes();">
                            </td>
                            <td>
                                <input type="button" value='リセット' class="buttonUi" style="font-size:10px"
                                       @click="value.resetStatusAdd();g_appData.__updateStatusBySkillsAndMergeForAllHeroes();">
                            </td>
                            <td></td>
                            <td v-bind:style="g_app.vm.debugMenuStyle">
                                <input type="button" value='リセット' class="buttonUi" style="font-size:10px"
                                    @click="value.updatePureGrowthRate();if(g_app.vm.gameMode == GameMode.ResonantBattles && isThief(value)){value.defGrowthRate=0.4;}g_app.__updateStatusBySkillsAndMergeForAllHeroes();">
                            </td>
                        </tr>
                        <tr>
                            <td colspan="7">
                                <div style="padding:5px">
                                    <div>
                                        <label class="normal" >状態({{ value.getPositiveStatusEffects().length }}, {{ value.getNegativeStatusEffects().length }}): </label>
                                        <span v-for="statusEffect in value.getPositiveStatusEffects()">
                                        <img v-bind:src="statusEffectTypeToIconFilePath(statusEffect)" style="width:15px;background-color: #88CCFF" v-bind:title="getStatusEffectName(statusEffect)" v-bind:alt="getStatusEffectName(statusEffect)" />
                                    </span>
                                        <span v-for="statusEffect in value.getNegativeStatusEffectsOrderedByNeutralizationPriority()">
                                        <img v-bind:src="statusEffectTypeToIconFilePath(statusEffect)" style="width:15px;background-color: #FFCCCC" v-bind:title="getStatusEffectName(statusEffect)" v-bind:alt="getStatusEffectName(statusEffect)" />
                                    </span>
                                    </div>
                                    <input type="button" class="buttonUi" value="全て付与"
                                           @click="g_app.vm.addAllPositiveStatusEffects();g_app.vm.addAllNegativeStatusEffects()" >
                                    <input type="button" class="buttonUi" value="全て解除"
                                           @click="g_app.vm.clearAllPositiveStatusEffects();g_app.vm.clearAllNegativeStatusEffects()" >
                                    <div class="normal">
                                        <details>
                                            <summary>有利なステータス詳細</summary>
                                            <input type="button" class="buttonUi" value="全て付与"
                                                   @click="g_app.vm.addAllPositiveStatusEffects()" >
                                            <input type="button" class="buttonUi" value="全て解除"
                                                   @click="g_app.vm.clearAllPositiveStatusEffects()" >
                                            <div v-for="statusEffect in getPositiveStatusEffectTypesInOrder()">
                                                <input v-bind:id='"statusEffect"+statusEffect' type="checkbox"
                                                       :checked="value.hasStatusEffect(statusEffect)"
                                                       @change="g_app.vm.statusEffectChanged(statusEffect)"
                                                />
                                                <label class="normal status-effect-description-label"
                                                       :title="`【${getStatusEffectName(statusEffect)}】${getStatusDescription(statusEffect)}`"
                                                       v-bind:for='"statusEffect"+statusEffect'>
                                                    【{{ getStatusEffectName(statusEffect)}}】<span class="status-effect-description">{{ getStatusDescription(statusEffect) }}</span>
                                                </label>
                                            </div>
                                        </details>
                                        <details>
                                            <summary>不利なステータス詳細</summary>
                                            <input type="button" class="buttonUi" value="全て付与"
                                                   @click="g_app.vm.addAllNegativeStatusEffects()" >
                                            <input type="button" class="buttonUi" value="全て解除"
                                                   @click="g_app.vm.clearAllNegativeStatusEffects()" >
                                            <div v-for="statusEffect in getNegativeStatusEffectTypesInOrder()">
                                                <input v-bind:id='"statusEffect"+statusEffect' type="checkbox"
                                                       :checked="value.hasStatusEffect(statusEffect)"
                                                       @change="g_app.vm.statusEffectChanged(statusEffect)"
                                                />
                                                <label class="normal status-effect-description-label"
                                                       :title="`【${getStatusEffectName(statusEffect)}】${getStatusDescription(statusEffect)}`"
                                                       v-bind:for='"statusEffect"+statusEffect'>
                                                    【{{ getStatusEffectName(statusEffect)}}】<span class="status-effect-description">{{ getStatusDescription(statusEffect) }}</span>
                                                </label>
                                            </div>
                                        </details>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="7">
                                <input v-bind:id='"isActionDone"+value.id' type="checkbox" v-model="value.isActionDone"
                                       @change="g_app.vm.actionDoneChanged"/>
                                <label class="normal" v-bind:for='"isActionDone"+value.id'>行動済み</label>

                                <input v-bind:id='"isCantoActivatedInCurrentTurn"+value.id' type="checkbox"
                                       v-model="value.isCantoActivatedInCurrentTurn"/>
                                <label class="normal"
                                       v-bind:for='"isCantoActivatedInCurrentTurn"+value.id'>再移動発動済み</label>

                                <input v-bind:id='"isEnemyActionTriggered"+value.id' type="checkbox"
                                       v-model="value.isEnemyActionTriggered"/>
                                <label class="normal"
                                       v-bind:for='"isEnemyActionTriggered"+value.id'>AIの行動制限解除</label>

                                <span v-if="isWeaponTypeBeast(value.weaponType)">
                                    <input v-bind:id='"isTransformed"+value.id' type="checkbox"
                                           v-model="value.isTransformed" @change="g_app.vm.mergeChanged"/>
                                    <label class="normal" v-bind:for='"isTransformed"+value.id'>化身状態</label>
                                </span>
                            </td>
                        </tr>
                        <tr v-bind:style="g_app.vm.debugMenuStyle">
                            <td colspan="7">
                                <input v-bind:id='"isSelected"+value.id' type="checkbox" v-model="value.isSelected" />
                                <label class="normal" v-bind:for='"isSelected"+value.id'>選択中</label>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <skill-form
                            v-model="value"
                            :g_app-data="g_appData"
                            :g_image-root-path="g_imageRootPath"
                            :vm="g_app.vm"
                            :is-summoner-duels="true"
                    >
                    </skill-form>
                    <skill-action-area
                            v-model="value"
                            :g_app="g_app"
                            :g_app-data="g_appData"
                    >
                    </skill-action-area>
                    <arena-score
                            v-model="value"
                            :g_app-data="g_appData"
                    >
                    </arena-score>
                    <unit-debug
                            v-model="value"
                            :g_app-data="g_appData"
                    >
                    </unit-debug>
                </td>
            </tr>
        </table>
    </script>

    <script>
        function showMjolnirsStrikeSettingDialog() {
            $('#mjolnirsStrikeSettingDialog').dialog('open');
        }
        function setImageSrcFromDatasetSrc(lazyImages) {
            for (let lazyImage of lazyImages) {
                if (lazyImage.src != lazyImage.dataset.src) {
                    lazyImage.src = lazyImage.dataset.src;
                }
            }
        }
        function setImageSrcToDummy(lazyImages) {
            const dummyImageUrl = "/images/dummy.png";
            for (let lazyImage of lazyImages) {
                if (lazyImage.src != dummyImageUrl) {
                    lazyImage.src = dummyImageUrl;
                }
            }
        }
        let g_imageAnalysisDialogOpened = false;
        function loadLazyTemplateImages() {
            if (!g_imageAnalysisDialogOpened) {
                return;
            }
            {
                let lazyImages = [].slice.call(document.querySelectorAll("img.lazyTemplateImage"));
                setImageSrcFromDatasetSrc(lazyImages);
            }

            let lazyImagesForArena = [].slice.call(document.querySelectorAll("img.lazyTemplateImageForArena"));
            let lazyImagesForAetherRaid = [].slice.call(document.querySelectorAll("img.lazyTemplateImageForAetherRaid"));
            switch (g_appData.gameMode) {
                case GameMode.Arena:
                    {
                        setImageSrcFromDatasetSrc(lazyImagesForArena);
                        setImageSrcToDummy(lazyImagesForAetherRaid);
                    }
                    break;
                case GameMode.AetherRaid:
                    {
                        setImageSrcFromDatasetSrc(lazyImagesForAetherRaid);
                        setImageSrcToDummy(lazyImagesForArena);
                    }
                    break;
            }
        }
        function showOcrSettingDialog() {
            g_imageAnalysisDialogOpened = true;
            $('#ocrSettingDialog').dialog('open');
            loadLazyTemplateImages();
            g_app.loadImageAnalysisLibraries();
        }
        function showDialog(id) {
            $(id).dialog('open');
        }
        function showSettingDialog() {
            $('#settingDialog').dialog('open');
        }
        function showExportDialog() {
            g_appData.updateExportText();
            $('#exportDialog').dialog('open');
        }
        function showImportDialog() {
            $('#importDialog').dialog('open');
        }
        function showSaveUnitDialog() {
            showDialog('#saveUnitDialog');
            g_appData.storeUnit();
            $('#saveUnitNameInput').val(g_appData.currentUnit.name);
        }
        function createDialog(elem, title, width = 370, height = 500, positionOf = "#unitSettings") {
            elem.dialog({
                autoOpen: false,
                modal: false,
                title: title,
                width: width,
                height: height,
                resizable: true,
                closeText: "",
                position: {
                    my: "left top",
                    at: "left top",
                    of: positionOf
                },
                buttons: [
                    {
                        html: '<span class="dialog-button-text">閉じる</span>',
                        class: 'dialog-button',
                        click: function () {
                            $(this).dialog("close");
                        }
                    },
                ]
            });
        }

        function createDialogs() {
            function setScroll(id) {
                let node = document.getElementById(id);
                let simpleLogPanelObserver = new MutationObserver(function (mutationsList, observer) {
                    // DOMに変更があった場合にスクロールを一番下に移動する
                    node.scrollTop = node.scrollHeight;
                });
                // オプション（監視する対象を指定）
                let config = {childList: true, subtree: true};

                // MutationObserverの設定
                simpleLogPanelObserver.observe(node, config);
            }

            setScroll("simpleLogPanel");
            setScroll("debugLogPanel");

            // タブ
            $('.jquery .tabs li').click(function () {
                var index = $('.jquery .tabs li').index(this);
                g_app.setCurrentUnitIndex(index);
            });

            createDialog($("#mjolnirsStrikeSettingDialog"), "ミョルニル査定計算の設定", 370, 500, "#mapArea");
            $("#ocrSettingDialog").dialog({
                autoOpen: false,
                modal: false,
                title: "画像から自動設定",
                width: 470,
                height: 600,
                closeText: "",
                position: {
                    my: "left bottom",
                    at: "left bottom",
                    of: "#mapArea"
                },
                buttons: [
                    {
                        html: '<span class="dialog-button-text">設定開始</span>',
                        class: 'dialog-button',
                        click: function () {
                            const files = document.getElementById("ocrSettingFile").files;
                            g_app.setUnitsByStatusImages(files);
                            var closeDialog = $("#closesDialogAfterStartAnalysis")[0].checked;
                            if (closeDialog) {
                                $(this).dialog("close");
                            }
                        }
                    },
                    {
                        html: '<span class="dialog-button-text">閉じる</span>',
                        class: 'dialog-button',
                        click: function () {
                            $(this).dialog("close");
                        }
                    },
                ]
            });
            createDialog($("#durabilityTestDialog"), "耐久/殲滅力テスト", 490, 700);
            createDialog($("#aetherRaidDefensePresetDialog"), "模擬戦相手の設定");
            createDialog($("#itemDialog"), "アイテム");
            createDialog($("#editMapDialog"), "マップ編集");
            createDialog($("#setupResonantBattleEnemyDialog"), "双界の敵ステータス設定");
            createDialog($("#autoClearDialog"), "お助けツール(開発中)");
            createDialog($("#settingDialog"), "詳細設定", 370, 370, "#mapArea");
            createDialog($("#exportDialog"), "設定のエクスポート", 370, 420, "#mapArea");
            createDialog($("#importDialog"), "設定のインポート", 370, 420, "#mapArea");
            createDialog($("#saveUnitDialog"), "ユニットの保存・読み込み", 500, 600);
        }
        function copyMapSourceCodeToClipboard() {
            var textarea = $("#mapSourceCode")[0];
            textarea.select();
            textarea.setSelectionRange(0, 99999);
            document.execCommand("copy");
        }
        function copySimpleLogToClipboard() {
            selectText("simpleLogPanel");
            document.execCommand("copy");
        }
        function copyDebugLogToClipboard() {
            selectText("debugLogPanel");
            document.execCommand("copy");
        }
        function copyExportUrlToClipboard() {
            var textarea = $("#exportUrl")[0];
            textarea.select();
            textarea.setSelectionRange(0, 99999); /*For mobile devices*/
            document.execCommand("copy");
        }
        function copyExportTextToClipboard() {
            var textarea = $("#exportText")[0];
            textarea.select();
            textarea.setSelectionRange(0, 99999); /*For mobile devices*/
            document.execCommand("copy");
        }
        function pasteClipboardToImportText() {
            // セキュリティの都合で(コピーしたパスワードなどを取得できないように)多くのブラウザでは動作しない
            var textarea = $("#importText")[0];
            textarea.focus();
            document.execCommand("paste");
        }
        function clearImportText() {
            var textarea = $("#importText")[0];
            textarea.value = '';
        }
        function importTextFromInputText(text, compressMode = null) {
            var loadsEnemySettings = $("#loadsEnemySettings")[0].checked;
            var loadsAllySettings = $("#loadsAllySettings")[0].checked;
            var loadsDefenceSettings = $("#loadsDefenceSettings")[0].checked;
            var loadsOffenceSettings = $("#loadsOffenceSettings")[0].checked;
            var loadsMapSettings = $("#loadsMapSettings")[0].checked;
            var textarea = $("#importText")[0];
            importSettingsFromString(
                text,
                loadsAllySettings,
                loadsEnemySettings,
                loadsOffenceSettings,
                loadsDefenceSettings,
                loadsMapSettings,
                compressMode);
            g_appData.setGameMode(GameMode.SummonerDuels);
            updateAllUi();
            var closeDialog = $("#closesDialogAfterImport")[0].checked;
            if (closeDialog) {
                $("#importDialog").dialog('close');
            }
        }
        function importText() {
            const textarea = $("#importText")[0];
            importTextFromInputText(textarea.value);
        }

        function importUrl(url) {
            console.log("url:" + url);
            if (url == "" || url == null) {
                return;
            }
            console.log(url);
            let splited = url.split("s=");
            if (splited.length != 2) {
                console.log(`invalid url "${url}"`);
                return;
            }

            let compressedSetting = splited[1];
            importTextFromInputText(compressedSetting, SettingCompressMode.Uri);
        }
    </script>

    <!-- jquery -->
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script> -->
    <script src="https://fire-emblem.fun/js/jquery-3.7.0.min.js"></script>

    <!-- select2 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css"
        media="print" onload="this.media='all'">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>

    <!-- jquery-ui -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.min.css" media="print"
        onload="this.media='all'">
    <script async src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <!-- vue.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.13/vue.min.js"></script>

    <!-- sortable.js -->
    <script async src="https://cdn.jsdelivr.net/npm/sortablejs@1.8.4/Sortable.min.js"></script>

    <!-- vuedraggable.js -->
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/2.23.2/vuedraggable.umd.min.js"></script>

    <!-- クッキー(実際は使ってないので消してもいいかも) -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script> -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- 文字列圧縮 -->
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

    <!-- 画像解析 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.min.css" media="print"
        onload="this.media='all'">
    <script async type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.min.js"></script>

    <!-- <script defer type="text/javascript" src="https://docs.opencv.org/4.2.0/opencv.js"></script> -->






    <script>
        function createScriptElement(src, onloadFunc) {
            let element = document.createElement("script");
            element.type = "text/javascript";
            element.src = src;
            element.onload = onloadFunc;
            // document.body.appendChild(element);
            let headElement = document.getElementsByTagName('head')[0];
            headElement.appendChild(element);
        }

        function loadScripts(scriptFileNames, allScriptLoaded, index = 0) {
            if (index == scriptFileNames.length) {
                allScriptLoaded();
                return;
            }

            let jsRootPath = "./";
            // jsRootPath = "/AetherRaidTacticsBoard/Release2/";
            let reloadSuffix = "20200513";
            let scriptFileName = scriptFileNames[index];
            let src = jsRootPath + scriptFileName + "?" + reloadSuffix;
            const startTime = Date.now();
            createScriptElement(src, x => {
                const endTime = Date.now();
                console.log(`${endTime - startTime} ms to load ${src}`);
                loadScripts(scriptFileNames, allScriptLoaded, ++index);
            });
        }

        $(function () {
            const isLocal = typeof weaponInfos == 'undefined';
            console.log(`isLocal=${isLocal}`);
            let additionalScripts = [];
            if (isLocal) {
                additionalScripts = [
                    "GlobalDefinitions_Debug.js",
                    "Cell.js",
                    "Table.js",
                    "Utilities.js",
                    "Logger.js",
                    "SkillConstants.js",
                    "Skill.js",
                    ...SKILL_EFFECT_FILES,
                    "BattleMapElement.js",
                    "Tile.js",
                    "Structures.js",
                    "HeroInfoConstants.js",
                    "HeroInfo.js",
                    "UnitConstants.js",
                    "BattleContext.js",
                    "Unit.js",
                    "UnitManager.js",
                    "BattleMap.js",
                    "BattleMapSettings.js",
                    "GlobalBattleContext.js",
                    "DamageCalculationUtility.js",
                    "DamageCalculator.js",
                    "PostCombatSkillHander.js",
                    "DamageCalculatorWrapper.js",
                    "BeginningOfTurnSkillHandler.js",
                    "TurnSetting.js",
                    "AudioManager.js",
                    "AetherRaidDefensePresets.js",
                    "SkillDatabase.js",
                    "HeroDatabase.js",
                    "SettingManager.js",
                    "AppData.js",
                    "Main_ImageProcessing.js",
                    "Main_OriginalAi.js",
                    "Main_MouseAndTouch.js",
                    "BattleSimulatorBase.js",
                    "SummonerDuelsSimulatorMain.js",
                    "VueComponents.js",
                    "SampleSkillInfos.js",
                    "SampleHeroInfos.js",
                    ...SKILL_IMPL_FILES,
                ];
            }

            const startTime = Date.now();
            loadScripts(additionalScripts, () => {
                const endTime = Date.now();
                console.log(`${endTime - startTime} ms to load all scripts`);
                console.log("initializing application");
                g_app.registerSkillOptions(weaponInfos, supportInfos, specialInfos, passiveAInfos, passiveBInfos, passiveCInfos,
                    passiveSInfos, passiveXInfos, captainInfos);
                g_app.registerHeroOptions(heroInfos, false);

                createDialogs();
                if (isLocal) {
                    loadLazyImages();
                }

                let diffTime = endTime - g_startTime;
                g_app.writeDebugLogLine(`ページの初期化: ${diffTime} ms`);
                initAetherRaidBoard(heroInfos);

                importUrl(location.search);

            });

            // ローカル開発環境の場合適切な位置までスクロールさせる
            if (isLocal) {
                const targetElement = document.getElementById('app');

                // targetElementが存在する場合にスクロール
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth', // スムーズスクロール
                        block: 'start'      // 要素の上端をスクロール位置に合わせる
                    });
                }
            }
        });
        // window.addEventListener('load', (event) => {
        // });
    </script>
</body>